<Window x:Class="DJBookingSystem.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:DJBookingSystem.Converters"
        xmlns:controls="clr-namespace:DJBookingSystem.Controls"
        xmlns:radio="clr-namespace:DJBookingSystem.Views.Radio"
        xmlns:views="clr-namespace:DJBookingSystem.Views"
        Title="DJ Booking System - The Fallen Collective" 
        Height="750" 
        Width="1200" 
        MinHeight="600"
        MinWidth="1000"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        Background="{DynamicResource AppBackgroundBrush}"
        WindowStyle="None"
        AllowsTransparency="True">
    <Window.Resources>
        <conv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>

        <!-- Base Button Style First -->
        <Style x:Key="BaseButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource AppPrimaryBrush}"/>
            <Setter Property="FontFamily" Value="Consolas"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <!-- Horizontal Menu Item Style -->
        <Style x:Key="HorizontalMenuItemStyle" TargetType="MenuItem">
            <Setter Property="Foreground" Value="#00FF00"/>
            <Setter Property="FontFamily" Value="Consolas"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border x:Name="Border"
                                Background="{TemplateBinding Background}"
                                BorderThickness="0"
                                Padding="{TemplateBinding Padding}">
                            <Grid>
                                <ContentPresenter ContentSource="Header"
                                                VerticalAlignment="Center"
                                                HorizontalAlignment="Center"
                                                RecognizesAccessKey="True"/>
                                <Popup x:Name="PART_Popup"
                                       Placement="Bottom"
                                       IsOpen="{TemplateBinding IsSubmenuOpen}"
                                       AllowsTransparency="True"
                                       Focusable="False"
                                       PopupAnimation="Fade">
                                    <Border Background="Transparent"
                                            BorderThickness="0"
                                            Padding="0">
                                        <StackPanel IsItemsHost="True"
                                                  KeyboardNavigation.DirectionalNavigation="Cycle"/>
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#00FF00"/>
                                <Setter Property="Foreground" Value="#000000"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#00AA00"/>
                                <Setter Property="Foreground" Value="#000000"/>
                            </Trigger>
                            <Trigger Property="IsSubmenuOpen" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#00FF00"/>
                                <Setter Property="Foreground" Value="#000000"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Window Control Button Style -->
        <Style x:Key="WindowControlButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
        </Style>

        <!-- Close Button Style -->
        <Style x:Key="CloseButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
        </Style>

        <!-- Sub Menu Item Style -->
        <Style x:Key="SubMenuItemStyle" TargetType="MenuItem">
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontFamily" Value="Cascadia Code"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="0,3,0,3"/>
            <Setter Property="Background" Value="#7D7D7D"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border x:Name="OuterBorder"
                                Background="Transparent"
                                Padding="0,2"
                                Margin="0">
                            <Border x:Name="InnerBorder"
                                    Background="{TemplateBinding Background}"
                                    BorderThickness="0"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter ContentSource="Header"
                                                VerticalAlignment="Center"
                                                RecognizesAccessKey="True"/>
                            </Border>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="InnerBorder" Property="Background" Value="#00FF00"/>
                                <Setter Property="Foreground" Value="#000000"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="#888888"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Border BorderBrush="#00FF00" BorderThickness="2" Background="#000000">
        <Grid Background="Black">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="274*"/>
                <RowDefinition Height="44*"/>
                <RowDefinition Height="223*"/>
            </Grid.RowDefinitions>

            <!-- Title Bar -->
            <Border Grid.Row="0" Background="#0A0A0A" BorderBrush="#00FF00" BorderThickness="0,0,0,1" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid Height="28">
                    <TextBlock FontFamily="Consolas" FontSize="10" Foreground="#00FF00" Margin="8,0" VerticalAlignment="Center"><Run Text="ðŸŽµ Online DJ BOOKING SYSTEM "/><Run Text="ðŸŽµ"/></TextBlock>
                    <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                        <Button x:Name="StayOnTopButton" Content="ðŸ“Œ" Click="StayOnTop_Click" Style="{StaticResource WindowControlButtonStyle}" ToolTip="Toggle Stay On Top"/>
                        <Button Content="â¬‡" Click="MinimizeToTray_Click" Style="{StaticResource WindowControlButtonStyle}" ToolTip="Minimize to System Tray"/>
                        <Button Content="ðŸšª" Click="Logout_Click" Style="{StaticResource WindowControlButtonStyle}" ToolTip="Logout"/>
                        <Button Content="âŒ" Click="Close_Click" Style="{StaticResource CloseButtonStyle}" ToolTip="Close Application"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Header -->
            <Border Grid.Row="1" Background="#0A0A0A" BorderBrush="#00FF00" BorderThickness="0,0,0,2">
                <Grid Margin="0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Top Left Corner: Cosmos -->
                    <controls:ClaudeIndicator x:Name="CosmosIndicator"
                                              Grid.Column="0"
                                              ServiceName="Azure Cosmos DB"
                                              LabelText="Cosmos"
                                              IsConnected="True"
                                              Margin="10,0"/>

                    <!-- LPM.fm -->
                    <controls:ClaudeIndicator x:Name="LPMIndicator"
                                              Grid.Column="2"
                                              ServiceName="Live Party Music"
                                              LabelText="LPM.fm"
                                              IsConnected="True"
                                              HorizontalAlignment="Left" 
                                              Margin="168,0,0,0"/>

                    <!-- Center Logo -->
                    <StackPanel Grid.Column="2" HorizontalAlignment="Center" Margin="0,25,0,0">
                        <TextBlock 
                                  FontSize="28" 
                                  FontWeight="Bold" 
                                  Foreground="#00BFFF" 
                                  FontFamily="Castellar" 
                                  Height="35" Width="506"><Run Text="âš¡ THE FALLEN COLLECTIVE "/><Run Text="âš¡"/><Run Text=" âš¡âš¡"/></TextBlock>
                        <TextBlock Text="ONLINE DJ BOOKING SYSTEM"
                                  FontSize="16"
                                  FontWeight="Bold"
                                  Foreground="#00FF00"
                                  FontFamily="Consolas"
                                  Height="18" Width="221"/>
                    </StackPanel>

                    <!-- RadioBoss/Booking - Between Logo and Right Corner -->
                    <controls:ClaudeIndicator x:Name="RadioBossIndicator"
                                              Grid.Column="2"
                                              ServiceName="RadioBOSS Control"
                                              LabelText="Booking"
                                              IsConnected="True"
                                              Margin="775,0,171,0"/>

                    <!-- Top Right Corner: Live Status -->
                    <controls:ClaudeIndicator x:Name="StreamIndicator"
                                              Grid.Column="4"
                                              ServiceName="Live Status Monitor"
                                              LabelText="Live Status"
                                              IsConnected="True"
                                              Margin="10,0"/>
                </Grid>
            </Border>

            <!-- Menu -->
            <Border Grid.Row="2" Background="#0A0A0A" BorderBrush="#00FF00" BorderThickness="0,0,0,2">
                <Menu Background="Black" Height="38" HorizontalAlignment="Center">
                    <MenuItem x:Name="BookingsMenuItem" Header="Bookings" Style="{StaticResource HorizontalMenuItemStyle}" Click="Menu_Bookings_Click"/>
                    <MenuItem x:Name="VenuesMenuItem" Header="Venues" Style="{StaticResource HorizontalMenuItemStyle}" Click="Menu_Venues_Click"/>

                    <!-- Radio - Simple button, no dropdown -->
                    <MenuItem x:Name="RadioMenuItem" Header="Radio" Style="{StaticResource HorizontalMenuItemStyle}" Click="Menu_Radio_Click"/>

                    <MenuItem x:Name="ChatMenuItem" Header="Chat" Style="{StaticResource HorizontalMenuItemStyle}" Click="Menu_Chat_Click"/>

                    <!-- Users - Simple button, no dropdown -->
                    <MenuItem x:Name="UsersMenuItem" Header="Users" Style="{StaticResource HorizontalMenuItemStyle}" Click="Menu_Users_Click"/>

                    <!-- Updater (Admin Only) -->
                    <MenuItem Header="Updater" x:Name="UpdaterMenuItem" Style="{StaticResource HorizontalMenuItemStyle}" Visibility="Collapsed" ToolTip="Admin Only - Deploy updates to server">
                        <MenuItem Header="ðŸ”„ Update Manager" Style="{StaticResource SubMenuItemStyle}" Click="Menu_UpdateManager_Click" FontWeight="Bold"/>
                        <Separator/>
                        <MenuItem Header="ðŸ“¤ Deploy New Update" Style="{StaticResource SubMenuItemStyle}" Click="Menu_DeployUpdate_Click"/>
                        <MenuItem Header="ðŸ” Test SSL Connection" Style="{StaticResource SubMenuItemStyle}" Click="Menu_TestSSL_Click"/>
                        <Separator/>
                        <MenuItem Header="ðŸ“š Documentation Center" Style="{StaticResource SubMenuItemStyle}" Click="Menu_Documentation_Click" ToolTip="View all training guides and documentation"/>
                        <Separator/>
                        <MenuItem Header="ðŸ—„ï¸ Database Cleanup" Style="{StaticResource SubMenuItemStyle}" Click="Menu_DatabaseCleanup_Click" ToolTip="Fix duplicate Users/users containers"/>
                        <Separator/>
                        <MenuItem Header="ðŸ“Š View Deployment History" Style="{StaticResource SubMenuItemStyle}" Click="Menu_DeploymentHistory_Click"/>
                        <MenuItem Header="ðŸ‘¥ User Update Statistics" Style="{StaticResource SubMenuItemStyle}" Click="Menu_UpdateStats_Click"/>
                    </MenuItem>

                    <!-- Settings - Simple button, no dropdown -->
                    <MenuItem x:Name="SettingsMenuItem" Header="Settings" Style="{StaticResource HorizontalMenuItemStyle}" Click="Menu_Settings_Click"/>

                    <!-- Tutorial Menu Item (Pink/Magenta style) -->
                    <MenuItem x:Name="TutorialMenuItem" 
                              Header="Tutorial" 
                              Click="Menu_Tutorial_Click"
                              Foreground="#FF00FF"
                              FontFamily="Consolas"
                              FontSize="13"
                              FontWeight="Bold"
                              Padding="15,8"
                              Background="#000000">
                        <MenuItem.Style>
                            <Style TargetType="MenuItem">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="MenuItem">
                                            <Border x:Name="Border"
                                                    Background="#000000"
                                                    BorderThickness="0"
                                                    Padding="{TemplateBinding Padding}">
                                                <ContentPresenter ContentSource="Header"
                                                                VerticalAlignment="Center"
                                                                HorizontalAlignment="Center"
                                                                RecognizesAccessKey="True"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsHighlighted" Value="True">
                                                    <Setter TargetName="Border" Property="Background" Value="#FF00FF"/>
                                                    <Setter Property="Foreground" Value="#000000"/>
                                                </Trigger>
                                                <Trigger Property="IsPressed" Value="True">
                                                    <Setter TargetName="Border" Property="Background" Value="#DD00DD"/>
                                                    <Setter Property="Foreground" Value="#000000"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </MenuItem.Style>
                    </MenuItem>

                    <!-- Tests Menu (Admin Only) -->
                    <MenuItem Header="ðŸ§ª Tests" 
                              x:Name="TestsMenuItem"
                              Style="{StaticResource HorizontalMenuItemStyle}"
                              Visibility="Collapsed">
                        <MenuItem Header="ðŸ‘¥ Diagnostic: User Count" Style="{StaticResource SubMenuItemStyle}" Click="Menu_DiagnosticUserCount_Click" FontWeight="Bold" ToolTip="Check how many users are actually in the database"/>
                        <Separator/>
                        <MenuItem Header="ðŸ“„ Test Documents" Style="{StaticResource SubMenuItemStyle}" Click="TestDocuments_Click"/>
                        <MenuItem Header="ðŸŽµ Test DJ Documents" Style="{StaticResource SubMenuItemStyle}" Click="TestDJDocuments_Click"/>
                        <MenuItem Header="ðŸŽ¨ Test Image Generation" Style="{StaticResource SubMenuItemStyle}" Click="TestImages_Click"/>
                        <Separator/>
                        <MenuItem Header="ðŸ“ Test File Manager" Style="{StaticResource SubMenuItemStyle}" Click="TestFileManager_Click"/>
                        <MenuItem Header="ðŸ’¾ Test Drive Search" Style="{StaticResource SubMenuItemStyle}" Click="TestDriveSearch_Click"/>
                        <MenuItem Header="ðŸŽ¤ Test Voice &amp; Sound" Style="{StaticResource SubMenuItemStyle}" Click="TestVoiceSound_Click"/>
                        <MenuItem Header="ðŸ“‚ Test File Organization" Style="{StaticResource SubMenuItemStyle}" Click="TestFileOrganization_Click"/>
                        <Separator/>
                        <MenuItem Header="ðŸ”„ Reset Tutorial Status (All Users)" Style="{StaticResource SubMenuItemStyle}" Click="ResetTutorialStatus_Click" ToolTip="Force all users to watch tutorial again"/>
                        <Separator/>
                        <MenuItem Header="âœ… Run All Tests" Style="{StaticResource SubMenuItemStyle}" Click="RunAllTests_Click" FontWeight="Bold"/>
                        <MenuItem Header="ðŸš€ Run Advanced Tests" Style="{StaticResource SubMenuItemStyle}" Click="RunAllAdvancedTests_Click" FontWeight="Bold"/>
                    </MenuItem>

                    <MenuItem Header="Help" Style="{StaticResource HorizontalMenuItemStyle}" Click="Menu_Help_Click"/>
                </Menu>
            </Border>

            <!-- Support -->
            <Border Grid.Row="3" Background="#0A0A0A" BorderBrush="#FF00FF" BorderThickness="0,0,0,2" Padding="8,5">
                <TextBlock Text="SUPPORTED BY: THE FALLEN COLLECTIVE &amp; MEGA BYTE I.T SERVICES" FontFamily="Castellar" FontSize="10" Foreground="#FF00FF" HorizontalAlignment="Center"/>
            </Border>

            <!-- Content -->
            <Border Grid.Row="4" Grid.RowSpan="3">
                <Border.Background>
                    <ImageBrush ImageSource="New-BG.png" Stretch="UniformToFill" Opacity="0.8"/>
                </Border.Background>
                <Grid>
                    <Grid x:Name="WelcomePanel" Visibility="Visible">
                        <TextBlock Text="Welcome" FontSize="32" Foreground="#00FF00" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="533,270,0,0" Height="72" Width="208"/>
                    </Grid>
                    <Grid x:Name="BookingsPanel" Visibility="Collapsed">
                        <ContentControl x:Name="BookingsViewContainer"/>
                    </Grid>
                    <Grid x:Name="VenuesManagementPanel" Visibility="Collapsed">
                        <ContentControl x:Name="VenuesManagementViewContainer"/>
                    </Grid>
                    <Grid x:Name="RadioPlayerPanel" Visibility="Collapsed">
                        <radio:RadioPlayerView x:Name="RadioPlayerView"/>
                    </Grid>
                    <Grid x:Name="RadioUnifiedPanel" Visibility="Collapsed">
                        <radio:RadioUnifiedView x:Name="RadioUnifiedView"/>
                    </Grid>
                    <Grid x:Name="RadioBossCloudPanel" Visibility="Collapsed">
                        <radio:RadioBossCloudView/>
                    </Grid>
                    <Grid x:Name="RadioBossStreamPanel" Visibility="Collapsed">
                        <radio:RadioBossStreamView />
                    </Grid>
                    <Grid x:Name="LiveRadioDatabasePanel" Visibility="Collapsed">
                        <views:LiveRadioDatabaseView/>
                    </Grid>
                    <Grid x:Name="LPMLiveStationsPanel" Visibility="Collapsed">
                        <views:LPMLiveStationsView/>
                    </Grid>
                    <Grid x:Name="ChatPanel" Visibility="Collapsed">
                        <views:ChatView/>
                    </Grid>
                    <Grid x:Name="SettingsPanel" Visibility="Collapsed">
                        <views:SettingsView/>
                    </Grid>
                    <Grid x:Name="UsersPanel" Visibility="Collapsed">
                        <ContentControl x:Name="UsersViewContainer"/>
                    </Grid>
                    <Grid x:Name="HelpPanel" Visibility="Collapsed">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                            <!-- ...existing help content... -->
                        </ScrollViewer>
                    </Grid>
                </Grid>
            </Border>

            <!-- CandyBot Avatar Overlay - VIDEO VERSION -->
            <controls:VideoCandyBotAvatar x:Name="CandyBotFloatingAvatar"
                Grid.Row="6"
                Width="120" 
                Height="120" 
                HorizontalAlignment="Right" 
                VerticalAlignment="Top"
                Panel.ZIndex="100" 
                AvatarClicked="CandyBot_Click"
                Cursor="Hand" 
                Margin="0,109,29,0" 
                RenderTransformOrigin="0.5,0.5">
                <controls:VideoCandyBotAvatar.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform/>
                        <SkewTransform/>
                        <RotateTransform Angle="1.506"/>
                        <TranslateTransform/>
                    </TransformGroup>
                </controls:VideoCandyBotAvatar.RenderTransform>
            </controls:VideoCandyBotAvatar>
        </Grid>
    </Border>
</Window>
