<Window x:Class="DJBookingSystem.CandyBotDesktopWidget"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Candy-Bot Desktop Widget" 
        Height="120" Width="120"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ResizeMode="NoResize"
        MouseLeftButtonDown="Window_MouseLeftButtonDown"
        MouseMove="Window_MouseMove"
        MouseLeftButtonUp="Window_MouseLeftButtonUp"
        MouseRightButtonDown="Window_MouseRightButtonDown"
        Loaded="Window_Loaded">

    <Window.Resources>
        <!-- Context Menu Style -->
        <Style x:Key="DesktopWidgetMenuStyle" TargetType="ContextMenu">
            <Setter Property="Background" Value="#1A1A1A"/>
            <Setter Property="BorderBrush" Value="#FF69B4"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="FontFamily" Value="Segoe UI, Consolas"/>
            <Setter Property="HasDropShadow" Value="False"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#FF69B4" BlurRadius="15" ShadowDepth="0" Opacity="0.8"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ContextMenu">
                        <Border Background="#1A1A1A"
                                BorderBrush="#FF69B4"
                                BorderThickness="2"
                                Margin="0"
                                Padding="0"
                                SnapsToDevicePixels="True">
                            <ScrollViewer Style="{DynamicResource {ComponentResourceKey ResourceId=MenuScrollViewer, TypeInTargetAssembly={x:Type FrameworkElement}}}">
                                <ItemsPresenter Margin="0" 
                                              SnapsToDevicePixels="True"
                                              KeyboardNavigation.DirectionalNavigation="Cycle"/>
                            </ScrollViewer>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Menu Item Style -->
        <Style x:Key="DesktopWidgetMenuItemStyle" TargetType="MenuItem">
            <Setter Property="Background" Value="#1A1A1A"/>
            <Setter Property="Foreground" Value="#FF69B4"/>
            <Setter Property="FontFamily" Value="Segoe UI, Consolas"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border x:Name="Border"
                                Background="#1A1A1A"
                                BorderBrush="Transparent"
                                BorderThickness="0"
                                Margin="0"
                                Padding="{TemplateBinding Padding}">
                            <Grid Background="#1A1A1A" Margin="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" MinWidth="20"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <ContentPresenter Grid.Column="0"
                                                Content="{TemplateBinding Icon}"
                                                Margin="0"
                                                Width="20"
                                                VerticalAlignment="Center"/>
                                
                                <ContentPresenter Grid.Column="1"
                                                ContentSource="Header"
                                                Margin="0"
                                                VerticalAlignment="Center"
                                                TextBlock.Foreground="{TemplateBinding Foreground}"/>
                                
                                <TextBlock Grid.Column="2"
                                          Text=">"
                                          FontSize="12"
                                          FontWeight="Bold"
                                          Foreground="{TemplateBinding Foreground}"
                                          Margin="15,0,5,0"
                                          VerticalAlignment="Center"
                                          Visibility="{Binding HasItems, RelativeSource={RelativeSource TemplatedParent}}"/>
                                
                                <Popup x:Name="PART_Popup"
                                      AllowsTransparency="True"
                                      Placement="Right"
                                      IsOpen="{Binding IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}"
                                      Focusable="False"
                                      PopupAnimation="Fade">
                                    <Border Background="#1A1A1A"
                                           BorderBrush="#FF69B4"
                                           BorderThickness="2"
                                           Margin="0"
                                           Padding="0">
                                        <StackPanel IsItemsHost="True"
                                                   Margin="0"
                                                   Background="#1A1A1A"/>
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                        
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#FF69B4"/>
                                <Setter Property="Foreground" Value="#000000"/>
                            </Trigger>
                            <Trigger Property="IsSubmenuOpen" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#FF69B4"/>
                                <Setter Property="Foreground" Value="#000000"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Bobbing Animation -->
        <Storyboard x:Key="BobbingAnimation" RepeatBehavior="Forever" AutoReverse="True">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                                          Storyboard.TargetName="AvatarBorder">
                <EasingDoubleKeyFrame KeyTime="0:0:0" Value="0"/>
                <EasingDoubleKeyFrame KeyTime="0:0:2" Value="-12">
                    <EasingDoubleKeyFrame.EasingFunction>
                        <SineEase EasingMode="EaseInOut"/>
                    </EasingDoubleKeyFrame.EasingFunction>
                </EasingDoubleKeyFrame>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
        
        <!-- Speech Bubble Popup Animation -->
        <Storyboard x:Key="SpeechBubbleAnimation">
            <DoubleAnimation Storyboard.TargetName="SpeechBubblePopup"
                           Storyboard.TargetProperty="Opacity"
                           From="0" To="1" Duration="0:0:0.3"/>
            <DoubleAnimation Storyboard.TargetName="SpeechBubbleScale"
                           Storyboard.TargetProperty="ScaleX"
                           From="0.5" To="1" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <BackEase EasingMode="EaseOut" Amplitude="0.3"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="SpeechBubbleScale"
                           Storyboard.TargetProperty="ScaleY"
                           From="0.5" To="1" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <BackEase EasingMode="EaseOut" Amplitude="0.3"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
    </Window.Resources>

    <Grid Margin="20,20,20,20" Background="Transparent">
        <!-- Main Avatar (80x80 to match main program) -->
        <Border x:Name="AvatarBorder"
                Width="80" Height="80"
                CornerRadius="40"
                Background="#2D1630"
                BorderBrush="#FF1493"
                BorderThickness="3"
                RenderTransformOrigin="0.5,0.5"
                VerticalAlignment="Center"
                HorizontalAlignment="Center">
            <Border.RenderTransform>
                <TranslateTransform/>
            </Border.RenderTransform>
            <Border.Effect>
                <DropShadowEffect Color="#FF1493" 
                                BlurRadius="20" 
                                ShadowDepth="0"
                                Opacity="0.7"/>
            </Border.Effect>
            
            <!-- Grid to hold Image and Status Indicator -->
            <Grid>
                <!-- Candy-Bot Avatar Image -->
                <Image x:Name="AvatarImage"
                       Source="/PNG_Version.png"
                       Stretch="UniformToFill"
                       RenderTransformOrigin="0.5,0.5">
                    <Image.Clip>
                        <EllipseGeometry Center="40,40" RadiusX="37" RadiusY="37"/>
                    </Image.Clip>
                </Image>
                
                <!-- Online Status Indicator -->
                <Ellipse Width="16" Height="16"
                        Fill="#00FF00"
                        VerticalAlignment="Bottom"
                        HorizontalAlignment="Right"
                        Margin="0,0,5,5">
                    <Ellipse.Effect>
                        <DropShadowEffect Color="#00FF00" 
                                        BlurRadius="8" 
                                        ShadowDepth="0"/>
                    </Ellipse.Effect>
                </Ellipse>
            </Grid>
        </Border>
        
        <!-- Speech Bubble Popup (appears on startup) -->
        <Border x:Name="SpeechBubblePopup"
                Width="220"
                Margin="90,0,0,0"
                HorizontalAlignment="Left"
                VerticalAlignment="Center"
                Background="#2D1630"
                BorderBrush="#FF1493"
                BorderThickness="2"
                CornerRadius="10"
                Padding="15,10"
                Opacity="0"
                RenderTransformOrigin="0,0.5">
            <Border.Effect>
                <DropShadowEffect Color="#FF1493" BlurRadius="15" ShadowDepth="0" Opacity="0.6"/>
            </Border.Effect>
            <Border.RenderTransform>
                <ScaleTransform x:Name="SpeechBubbleScale" ScaleX="1" ScaleY="1"/>
            </Border.RenderTransform>
            
            <StackPanel>
                <TextBlock x:Name="SpeechBubbleText"
                           Text="Hi! Right-click me for options!"
                           Foreground="#FF1493"
                           FontSize="13"
                           FontWeight="Bold"
                           TextWrapping="Wrap"
                           TextAlignment="Center"/>
                           
                <!-- Speech bubble pointer -->
                <Polygon Points="0,0 10,10 0,20"
                         Fill="#2D1630"
                         Stroke="#FF1493"
                         StrokeThickness="2"
                         HorizontalAlignment="Left"
                         Margin="-17,0,0,-30"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
