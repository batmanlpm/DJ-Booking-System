# ?? SIMPLE COSMOS DB MIGRATION - Uses existing code
# Migrates users from Users to users container

Write-Host "`n??????????????????????????????????????????????????????????????????" -ForegroundColor Cyan
Write-Host "?         ?? MIGRATING USERS TO NEW CONTAINER                   ?" -ForegroundColor Cyan
Write-Host "??????????????????????????????????????????????????????????????????" -ForegroundColor Cyan

Write-Host "`n??  This will copy all users from 'Users' to 'users' container" -ForegroundColor Yellow
$confirm = Read-Host "`nType 'YES' to continue"

if ($confirm -ne "YES") {
    Write-Host "`n? Migration cancelled" -ForegroundColor Red
    exit
}

# Build the migration tool
Write-Host "`n?? Building migration tool..." -ForegroundColor Cyan
Set-Location Tools
dotnet build MigrationTool.csproj -c Release

if ($LASTEXITCODE -ne 0) {
    Write-Host "`n? Build failed!" -ForegroundColor Red
    Set-Location ..
    exit
}

# Run the migration
Write-Host "`n?? Running migration..." -ForegroundColor Cyan
dotnet run --project MigrationTool.csproj -c Release

Set-Location ..

Write-Host "`n? MIGRATION COMPLETE!" -ForegroundColor Green
Write-Host "`nThe code is already updated to use the new 'users' container." -ForegroundColor White
Write-Host "Test user registration and login now!" -ForegroundColor Yellow
