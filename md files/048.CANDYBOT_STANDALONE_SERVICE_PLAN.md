# ?? CANDYBOT STANDALONE SERVICE - IMPLEMENTATION PLAN

## ?? GOAL
Transform CandyBot Desktop Mode into a fully independent Windows service with local resources.

---

## ?? REQUIREMENTS

### 1. Local Resource Storage
```
%LocalAppData%\CandyBot\
??? Icons\
?   ??? search.png
?   ??? chat.png
?   ??? help.png
?   ??? music.png
?   ??? document.png
?   ??? image.png
?   ??? video.png
?   ??? code.png
?   ??? settings.png
?   ??? candybot-avatar.png
??? Config\
?   ??? settings.json
?   ??? personality.json
?   ??? approved-folders.json
??? Cache\
?   ??? (temporary files)
??? Logs\
    ??? candybot.log
```

### 2. Windows Service Installation
- Service Name: `CandyBotService`
- Display Name: "Candy-Bot AI Assistant"
- Startup Type: Automatic (Delayed Start)
- Runs as: Current User
- Independent of DJBookingSystem.exe

### 3. Icon Pack Requirements
All icons needed (32x32 PNG with transparency):
- ?? Search
- ?? Chat
- ? Help
- ?? Music
- ?? Document
- ??? Image
- ?? Video
- ?? Code
- ?? Settings
- ?? DJ
- ?? Audio
- ?? Info
- ? Close
- ?? Pin
- ?? Start
- ?? AI

---

## ??? ARCHITECTURE

### Current (Dependent)
```
DJBookingSystem.exe
??? CandyBotDesktopWidget (embedded)
    ??? Resources (app resources)
```

### New (Independent)
```
User System
??? DJBookingSystem.exe (main app)
?   ??? Can launch CandyBot
??? CandyBot Service (independent)
    ??? CandyBotService.exe
    ??? CandyBotDesktopWidget.exe
    ??? Local Resources
    ??? Configuration
```

---

## ?? IMPLEMENTATION STEPS

### Phase 1: Create Icon Resource Pack
**File:** `Services/CandyBotIconManager.cs`

```csharp
public class CandyBotIconManager
{
    private static readonly string IconPath = Path.Combine(
        Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData),
        "CandyBot", "Icons");
    
    public static void EnsureIconsExist()
    {
        // Create icon directory
        Directory.CreateDirectory(IconPath);
        
        // Extract embedded icons or download from resources
        ExtractIcon("search.png");
        ExtractIcon("chat.png");
        // ... etc
    }
    
    public static BitmapImage GetIcon(string iconName)
    {
        string path = Path.Combine(IconPath, iconName);
        if (File.Exists(path))
        {
            var img = new BitmapImage();
            img.BeginInit();
            img.UriSource = new Uri(path);
            img.CacheOption = BitmapCacheOption.OnLoad;
            img.EndInit();
            return img;
        }
        return null;
    }
}
```

### Phase 2: Create Installation Service
**File:** `Services/CandyBotInstaller.cs`

```csharp
public class CandyBotInstaller
{
    private const string ServiceName = "CandyBotService";
    
    public static bool InstallService()
    {
        try
        {
            // Create installation directory
            string installPath = Path.Combine(
                Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData),
                "CandyBot");
            
            Directory.CreateDirectory(installPath);
            
            // Copy executable
            string exePath = Assembly.GetExecutingAssembly().Location;
            string targetPath = Path.Combine(installPath, "CandyBotDesktop.exe");
            File.Copy(exePath, targetPath, true);
            
            // Install icons
            CandyBotIconManager.EnsureIconsExist();
            
            // Create startup shortcut
            CreateStartupShortcut(targetPath);
            
            // Register with Windows
            RegisterWithWindows(targetPath);
            
            return true;
        }
        catch (Exception ex)
        {
            Debug.WriteLine($"Installation failed: {ex.Message}");
            return false;
        }
    }
    
    private static void CreateStartupShortcut(string targetPath)
    {
        string startupFolder = Environment.GetFolderPath(
            Environment.SpecialFolder.Startup);
        string shortcutPath = Path.Combine(startupFolder, "CandyBot.lnk");
        
        // Create shortcut using Windows Script Host
        var shell = new IWshRuntimeLibrary.WshShell();
        var shortcut = (IWshRuntimeLibrary.IWshShortcut)shell.CreateShortcut(shortcutPath);
        shortcut.TargetPath = targetPath;
        shortcut.WorkingDirectory = Path.GetDirectoryName(targetPath);
        shortcut.Description = "Candy-Bot AI Assistant";
        shortcut.Save();
    }
    
    private static void RegisterWithWindows(string exePath)
    {
        // Add to Windows registry for "Apps & Features"
        using (var key = Registry.CurrentUser.OpenSubKey(
            @"Software\Microsoft\Windows\CurrentVersion\Uninstall", true))
        {
            using (var subkey = key.CreateSubKey("CandyBot"))
            {
                subkey.SetValue("DisplayName", "Candy-Bot AI Assistant");
                subkey.SetValue("DisplayVersion", "1.0.0");
                subkey.SetValue("Publisher", "Fallen Collective");
                subkey.SetValue("InstallLocation", Path.GetDirectoryName(exePath));
                subkey.SetValue("UninstallString", $"\"{exePath}\" /uninstall");
            }
        }
    }
}
```

### Phase 3: Create Standalone Executable
**New Project:** `CandyBotDesktop.csproj`

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <OutputType>WinExe</OutputType>
    <TargetFramework>net8.0-windows</TargetFramework>
    <UseWPF>true</UseWPF>
    <ApplicationIcon>candybot.ico</ApplicationIcon>
    <StartupObject>CandyBot.Program</StartupObject>
  </PropertyGroup>
  
  <ItemGroup>
    <!-- Embed all icons -->
    <EmbeddedResource Include="Icons\**\*.png" />
  </ItemGroup>
</Project>
```

**File:** `CandyBotDesktop/Program.cs`

```csharp
public class Program
{
    [STAThread]
    static void Main(string[] args)
    {
        // Single instance check
        bool createdNew;
        using (var mutex = new Mutex(true, "CandyBotDesktopInstance", out createdNew))
        {
            if (!createdNew)
            {
                // Already running - activate existing instance
                ActivateExistingInstance();
                return;
            }
            
            // Initialize
            var app = new Application();
            app.ShutdownMode = ShutdownMode.OnExplicitShutdown;
            
            // Create widget
            var widget = new CandyBotDesktopWidget();
            widget.Show();
            
            app.Run();
        }
    }
    
    private static void ActivateExistingInstance()
    {
        // Send message to existing instance to show
        // (Implementation using named pipes or WCF)
    }
}
```

### Phase 4: Update Desktop Widget to Use Local Icons
**File:** `CandyBotDesktopWidget.xaml`

```xaml
<Window>
    <!-- Title Bar with local icon -->
    <Grid>
        <Image x:Name="TitleIcon" 
               Width="16" 
               Height="16"
               Margin="5,0,0,0"/>
        <TextBlock Text="[Candy-Bot] Desktop Widget"/>
    </Grid>
    
    <!-- Buttons with local icons -->
    <Button Click="QuickSearch_Click">
        <StackPanel Orientation="Horizontal">
            <Image x:Name="SearchIcon" Width="16" Height="16" Margin="0,0,5,0"/>
            <TextBlock Text="Search"/>
        </StackPanel>
    </Button>
</Window>
```

**File:** `CandyBotDesktopWidget.xaml.cs`

```csharp
public partial class CandyBotDesktopWidget : Window
{
    public CandyBotDesktopWidget()
    {
        InitializeComponent();
        LoadLocalIcons();
    }
    
    private void LoadLocalIcons()
    {
        TitleIcon.Source = CandyBotIconManager.GetIcon("candybot-avatar.png");
        SearchIcon.Source = CandyBotIconManager.GetIcon("search.png");
        ChatIcon.Source = CandyBotIconManager.GetIcon("chat.png");
        HelpIcon.Source = CandyBotIconManager.GetIcon("help.png");
        // ... load all icons
    }
}
```

---

## ?? ICON CREATION STRATEGY

### Option 1: Use Built-in Windows Icons
Extract from `shell32.dll`, `imageres.dll`:

```csharp
public static class WindowsIconExtractor
{
    [DllImport("shell32.dll")]
    private static extern IntPtr ExtractIcon(IntPtr hInst, string lpszExeFileName, int nIconIndex);
    
    public static BitmapImage ExtractSystemIcon(string dllName, int iconIndex)
    {
        // Extract icon from Windows DLL
        // Convert to BitmapImage
        // Save to local storage
    }
}
```

### Option 2: Generate Simple Icons Programmatically

```csharp
public static class IconGenerator
{
    public static void CreateSearchIcon()
    {
        var bitmap = new RenderTargetBitmap(32, 32, 96, 96, PixelFormats.Pbgra32);
        var visual = new DrawingVisual();
        
        using (var context = visual.RenderOpen())
        {
            // Draw magnifying glass
            context.DrawEllipse(null, new Pen(Brushes.HotPink, 2), 
                new Point(16, 16), 10, 10);
            context.DrawLine(new Pen(Brushes.HotPink, 2), 
                new Point(23, 23), new Point(28, 28));
        }
        
        bitmap.Render(visual);
        SaveAsPng(bitmap, "search.png");
    }
}
```

### Option 3: Download Icon Pack
Use free icon set (MIT License):
- Material Design Icons
- Font Awesome (as PNG)
- Feather Icons

```csharp
public static class IconDownloader
{
    private const string IconCdnBase = "https://cdn.example.com/icons/";
    
    public static async Task DownloadIconPack()
    {
        var icons = new[] 
        {
            "search.png",
            "chat.png",
            // ... etc
        };
        
        using (var client = new HttpClient())
        {
            foreach (var icon in icons)
            {
                var data = await client.GetByteArrayAsync(IconCdnBase + icon);
                var path = Path.Combine(IconPath, icon);
                await File.WriteAllBytesAsync(path, data);
            }
        }
    }
}
```

---

## ?? INSTALLATION FLOW

### From Main Application

```csharp
// MainWindow.xaml.cs or CandyBotAvatar.xaml.cs
private async void InstallDesktopMode_Click(object sender, RoutedEventArgs e)
{
    var result = MessageBox.Show(
        "Install Candy-Bot Desktop Mode?\n\n" +
        "This will:\n" +
        "• Create a standalone CandyBot widget\n" +
        "• Add to Windows startup\n" +
        "• Store resources locally\n" +
        "• Run independently of DJ Booking System\n\n" +
        "Continue?",
        "Install CandyBot Desktop Mode",
        MessageBoxButton.YesNo,
        MessageBoxImage.Question);
    
    if (result == MessageBoxResult.Yes)
    {
        var progress = new ProgressWindow();
        progress.Show();
        
        try
        {
            progress.UpdateStatus("Creating installation directory...");
            await Task.Delay(500);
            
            progress.UpdateStatus("Extracting icons...");
            CandyBotIconManager.EnsureIconsExist();
            await Task.Delay(500);
            
            progress.UpdateStatus("Installing service...");
            bool success = CandyBotInstaller.InstallService();
            await Task.Delay(500);
            
            progress.UpdateStatus("Configuring startup...");
            await Task.Delay(500);
            
            progress.Close();
            
            if (success)
            {
                MessageBox.Show(
                    "? CandyBot Desktop Mode installed successfully!\n\n" +
                    "You can now:\n" +
                    "• Find CandyBot in your system tray\n" +
                    "• It will start automatically with Windows\n" +
                    "• Use it even when DJ Booking System is closed\n\n" +
                    "Launch CandyBot now?",
                    "Installation Complete",
                    MessageBoxButton.YesNo,
                    MessageBoxImage.Information);
                
                if (result == MessageBoxResult.Yes)
                {
                    LaunchCandyBotDesktop();
                }
            }
        }
        catch (Exception ex)
        {
            progress.Close();
            MessageBox.Show(
                $"Installation failed: {ex.Message}",
                "Error",
                MessageBoxButton.OK,
                MessageBoxImage.Error);
        }
    }
}

private void LaunchCandyBotDesktop()
{
    string exePath = Path.Combine(
        Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData),
        "CandyBot", "CandyBotDesktop.exe");
    
    if (File.Exists(exePath))
    {
        Process.Start(exePath);
    }
}
```

---

## ?? FILE STRUCTURE

### Installation Directory
```
%LocalAppData%\CandyBot\
?
??? CandyBotDesktop.exe          (standalone executable)
??? candybot.ico                  (application icon)
?
??? Icons\                        (32x32 PNG icons)
?   ??? search.png
?   ??? chat.png
?   ??? help.png
?   ??? music.png
?   ??? document.png
?   ??? image.png
?   ??? video.png
?   ??? code.png
?   ??? settings.png
?   ??? ai.png
?   ??? dj.png
?   ??? audio.png
?   ??? info.png
?   ??? close.png
?   ??? pin.png
?   ??? candybot-avatar.png
?
??? Config\
?   ??? settings.json             (user preferences)
?   ??? personality.json          (personality mode)
?   ??? approved-folders.json     (file search permissions)
?   ??? api-keys.encrypted        (encrypted API keys)
?
??? Cache\
?   ??? search-history.json
?   ??? recent-queries.json
?
??? Logs\
    ??? candybot.log              (diagnostic log)
```

---

## ?? DEPLOYMENT CHECKLIST

### Development
- [ ] Create `CandyBotIconManager` service
- [ ] Create `CandyBotInstaller` service
- [ ] Extract/generate all required icons
- [ ] Create standalone `CandyBotDesktop.exe` project
- [ ] Implement single-instance check
- [ ] Add system tray integration
- [ ] Test installation process

### Icons
- [ ] Search icon (magnifying glass)
- [ ] Chat icon (speech bubble)
- [ ] Help icon (question mark)
- [ ] Music icon (note)
- [ ] Document icon (paper)
- [ ] Image icon (picture)
- [ ] Video icon (film)
- [ ] Code icon (brackets)
- [ ] Settings icon (gear)
- [ ] AI icon (robot/brain)
- [ ] DJ icon (headphones)
- [ ] Audio icon (speaker)
- [ ] Info icon (i)
- [ ] Close icon (X)
- [ ] Pin icon (pushpin)
- [ ] CandyBot avatar icon

### Installation
- [ ] Create local storage directories
- [ ] Copy executable to AppData
- [ ] Extract all icons
- [ ] Create startup shortcut
- [ ] Register with Windows
- [ ] Create uninstall entry
- [ ] Test auto-start

### Testing
- [ ] Install from main app
- [ ] Verify icons display
- [ ] Test standalone launch
- [ ] Test with app closed
- [ ] Test Windows startup
- [ ] Test uninstall
- [ ] Test updates

---

## ?? BENEFITS

### For Users
? CandyBot runs independently
? Available even when DJ app is closed
? Starts automatically with Windows
? All resources stored locally
? No dependency on network icons
? Fast, reliable performance

### For Developers
? Clean separation of concerns
? Easier to maintain
? Can update independently
? Better resource management
? Standard Windows app structure

---

## ?? UPDATE MECHANISM

```csharp
public class CandyBotUpdater
{
    public static async Task<bool> CheckForUpdates()
    {
        // Check version from main app
        string currentVersion = GetInstalledVersion();
        string latestVersion = GetMainAppVersion();
        
        if (Version.Parse(latestVersion) > Version.Parse(currentVersion))
        {
            var result = MessageBox.Show(
                $"CandyBot Desktop update available!\n\n" +
                $"Current: {currentVersion}\n" +
                $"Latest: {latestVersion}\n\n" +
                "Update now?",
                "Update Available",
                MessageBoxButton.YesNo);
            
            if (result == MessageBoxResult.Yes)
            {
                return await PerformUpdate();
            }
        }
        
        return false;
    }
}
```

---

Would you like me to:
1. ? **Implement the icon extraction system**
2. ? **Create the installer service**
3. ? **Build the standalone executable project**
4. ? **Set up the local storage structure**

**This will make CandyBot Desktop truly independent and professional!**
