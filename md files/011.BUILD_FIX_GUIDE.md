# ?? BUILD ERRORS - MAINWINDOW.XAML.CS INCOMPLETE

## ?? **Current Status: Build Failed**

The MainWindow.xaml.cs file is incomplete and missing many critical methods.

---

## ?? **Missing Methods List:**

### **Window Initialization Methods:**
1. `InitializeSystemTray()` - System tray icon setup
2. `UpdateTitleBarUserInfo()` - Display user info in title bar
3. `ApplySettings()` - Apply application settings
4. `ApplyPermissions()` - Apply user role permissions
5. `ApplyUserPreferences()` - Apply user preferences
6. `CheckConnectionsAsync()` - Check service connections
7. `UpdateRadioStatusIndicator(bool)` - Update radio status display

### **Window Control Methods:**
8. `TitleBar_MouseLeftButtonDown()` - Drag window
9. `MinimizeToTray_Click()` - Minimize to system tray
10. `Logout_Click()` - Logout and return to login
11. `Close_Click()` - Close application
12. `MySettings_Click()` - Open settings window

### **Candy-Bot Methods:**
13. `MainWindow_Loaded()` - Show Candy-Bot welcome
14. `CandyBot_Click()` - Open Candy-Bot window
15. Various Candy-Bot event handlers

---

## ??? **Quick Fix Options:**

### **Option 1: Restore from Git (Recommended)**
```bash
# Check git history for last working version
git log --oneline MainWindow.xaml.cs
git show <commit-hash>:MainWindow.xaml.cs > MainWindow.xaml.cs.backup
```

### **Option 2: Create Stub Methods**
Add these stub methods to MainWindow.xaml.cs to make it compile:

```csharp
// Add before the closing braces

#region Initialization Methods

private void InitializeSystemTray()
{
    // TODO: Implement system tray
}

private void UpdateTitleBarUserInfo()
{
    if (TitleBarUserInfo != null && _currentUser != null)
    {
        TitleBarUserInfo.Text = $"Logged in as: {_currentUser.FullName}";
    }
}

private void ApplySettings()
{
    if (_appSettings != null)
    {
        this.Title = _appSettings.AppTitle;
    }
}

private void ApplyPermissions()
{
    if (_currentUser != null && _currentUser.Role == UserRole.SysAdmin)
    {
        if (AdminMenuItem != null)
            AdminMenuItem.Visibility = Visibility.Visible;
    }
}

private void ApplyUserPreferences()
{
    if (_currentUser?.AppPreferences != null)
    {
        this.Topmost = _currentUser.AppPreferences.StayOnTop;
    }
}

#endregion

#region Connection Monitoring

private async Task CheckConnectionsAsync()
{
    try
    {
        if (_cosmosDbService != null)
        {
            bool cosmosOk = await _cosmosDbService.TestConnectionAsync();
            CosmosIndicator.IsConnected = cosmosOk;
        }
        
        // Check other services...
        LPMIndicator.IsConnected = true; // Placeholder
        RadioBossIndicator.IsConnected = true; // Placeholder
        StreamIndicator.IsConnected = true; // Placeholder
        
        // Update radio status
        UpdateRadioStatusIndicator(true);
    }
    catch (Exception ex)
    {
        System.Diagnostics.Debug.WriteLine($"Error checking connections: {ex.Message}");
    }
}

private void UpdateRadioStatusIndicator(bool isOnline)
{
    if (RadioStatusIndicator != null && RadioStatusText != null)
    {
        if (isOnline)
        {
            RadioStatusIndicator.Fill = new SolidColorBrush(Color.FromRgb(0, 255, 0));
            RadioStatusText.Text = "RADIO OPEN";
            RadioStatusText.Foreground = new SolidColorBrush(Color.FromRgb(0, 255, 0));
        }
        else
        {
            RadioStatusIndicator.Fill = new SolidColorBrush(Color.FromRgb(255, 0, 0));
            RadioStatusText.Text = "RADIO CLOSED";
            RadioStatusText.Foreground = new SolidColorBrush(Color.FromRgb(255, 0, 0));
        }
    }
}

#endregion

#region Window Controls

private void TitleBar_MouseLeftButtonDown(object sender, MouseButtonEventArgs e)
{
    try
    {
        if (e.ClickCount == 2)
        {
            WindowState = WindowState == WindowState.Maximized ? WindowState.Normal : WindowState.Maximized;
        }
        else
        {
            DragMove();
        }
    }
    catch { }
}

private void MinimizeToTray_Click(object sender, RoutedEventArgs e)
{
    this.WindowState = WindowState.Minimized;
}

private void Logout_Click(object sender, RoutedEventArgs e)
{
    var loginWindow = new LoginWindow(_cosmosDbService);
    loginWindow.Show();
    this.Close();
}

private void Close_Click(object sender, RoutedEventArgs e)
{
    this.Close();
}

private void MySettings_Click(object sender, RoutedEventArgs e)
{
    var settingsWindow = new UserSettingsWindow(_currentUser, _cosmosDbService);
    settingsWindow.Owner = this;
    settingsWindow.ShowDialog();
}

#endregion

#region Candy-Bot

private void MainWindow_Loaded(object sender, RoutedEventArgs e)
{
    // Show Candy-Bot welcome if first time
    if (_currentUser?.AppPreferences?.FirstTimeUser == true)
    {
        var welcome = new CandyBotWelcomeWindow();
        welcome.Owner = this;
        welcome.ShowDialog();
        
        if (_currentUser.AppPreferences != null)
        {
            _currentUser.AppPreferences.FirstTimeUser = false;
        }
    }
}

private void CandyBot_Click(object sender, RoutedEventArgs e)
{
    try
    {
        var candyBotService = new CandyBotService(_currentUser, _cosmosDbService);
        var candyBotWindow = new CandyBotWindow(_currentUser, candyBotService, null);
        candyBotWindow.Show();
    }
    catch (Exception ex)
    {
        MessageBox.Show(
            $"Error opening Candy-Bot: {ex.Message}",
            "Error",
            MessageBoxButton.OK,
            MessageBoxImage.Error);
    }
}

#endregion
```

---

## ?? **Next Steps:**

1. **Check Git History:**
   - Look for last working commit of MainWindow.xaml.cs
   - Compare with current version

2. **Add Stub Methods:**
   - Copy the stub methods above
   - Add to MainWindow.xaml.cs before closing braces

3. **Remove Menu_Radio_Click:**
   - This method in MenuHandlers still references RadioPanel
   - Either remove it or update to show submenu

4. **Build and Test:**
   - Build project after adding stubs
   - Test basic functionality
   - Implement full methods later

5. **Clean Up MenuHandlers:**
   - Remove references to RadioPanel
   - Remove calls to non-existent methods in LoadLiveRadioStations/LoadMyStationDatabase

---

## ?? **Priority Actions:**

### **Immediate (To Build):**
- [ ] Add all stub methods to MainWindow.xaml.cs
- [ ] Fix Menu_Radio_Click in MenuHandlers
- [ ] Remove _allLiveRadioStations and _myStationDatabase references

### **Short Term (To Run):**
- [ ] Implement CheckConnectionsAsync properly
- [ ] Implement window control methods
- [ ] Test Now Playing functionality

### **Long Term (To Complete):**
- [ ] Full system tray implementation
- [ ] Complete radio station database
- [ ] Audio player integration

---

## ?? **Current File Status:**

| File | Status | Issue |
|------|--------|-------|
| MainWindow.xaml | ? Complete | Clean, no duplicates |
| MainWindow.xaml.cs | ? Incomplete | Missing ~15 methods |
| MainWindow.MenuHandlers.cs | ?? Partial | Has LoadLiveRadioStations/LoadMyStationDatabase with errors |

---

**Recommendation:** Add stub methods first to get a working build, then implement full functionality incrementally.

