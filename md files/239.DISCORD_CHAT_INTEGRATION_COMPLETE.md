# Discord Chat Integration - Testing Guide

## Overview
Full bidirectional Discord chat integration using Discord.Net library for real-time messaging.

## Features Implemented

### 1. Real-Time Communication
- ? Send messages from app to Discord channel
- ? Receive messages from Discord channel in real-time
- ? Visual indicators for message types (Discord vs Local vs System)
- ? Automatic reconnection handling
- ? Connection status monitoring

### 2. Visual Indicators
- **Discord Messages**: Purple border (#5865F2) with ?? icon
- **Local Messages**: Green border (#00FF00) with ?? icon
- **System Messages**: Gold border (#FFD700) with status icons

### 3. Settings Persistence
- Settings saved to: `%USERPROFILE%\Documents\DJBookingSystem\discord_settings.json`
- Auto-connects on app restart if valid credentials exist

## Setup Instructions

### Step 1: Create Discord Bot
1. Go to https://discord.com/developers/applications
2. Click "New Application" and name it (e.g., "DJ Booking Bot")
3. Go to the "Bot" section and click "Add Bot"
4. Click "Reset Token" and copy the bot token (save it securely)

### Step 2: Configure Bot Permissions
1. In the Bot section, scroll to "Privileged Gateway Intents"
2. Enable the following intents:
   - ? **MESSAGE CONTENT INTENT** (Required!)
   - ? Server Members Intent (Optional)
   - ? Presence Intent (Optional)

### Step 3: Generate Invite Link
1. Go to OAuth2 ? URL Generator
2. Select scopes:
   - ? bot
3. Select bot permissions:
   - ? Send Messages
   - ? Read Messages/View Channels
   - ? Read Message History
4. Copy the generated URL

### Step 4: Invite Bot to Server
1. Open the copied URL in your browser
2. Select your Discord server
3. Click "Authorize"

### Step 5: Get Channel ID
1. Open Discord
2. Go to User Settings ? Advanced
3. Enable "Developer Mode"
4. Right-click the channel you want to use
5. Click "Copy ID"

### Step 6: Configure in App
1. Open DJ Booking System
2. Navigate to Chat View
3. Click "?? CONNECT" button
4. Enter:
   - **Bot Token**: The token from Step 1
   - **Channel ID**: The ID from Step 5
   - **Channel Name**: Display name (e.g., "#general")
5. Click "?? TEST CONNECTION"
6. If successful, click "? SAVE"

## Testing Checklist

### Basic Functionality
- [ ] Bot token and channel ID can be entered
- [ ] Test connection button validates credentials
- [ ] Settings are saved and persist across sessions
- [ ] Connection status is displayed correctly

### Send Messages (App ? Discord)
- [ ] Type message in app and press Enter
- [ ] Message appears in Discord channel
- [ ] Message appears in app's local chat
- [ ] Send to Discord checkbox toggles correctly

### Receive Messages (Discord ? App)
- [ ] Type message in Discord channel
- [ ] Message appears in app within 2 seconds
- [ ] Message shows Discord user's name
- [ ] Message has purple border and Discord indicator
- [ ] Messages from bot itself are ignored

### Visual Indicators
- [ ] Discord messages: Purple border + ?? icon
- [ ] Local messages: Green border + ?? icon
- [ ] System messages: Gold border + status icon
- [ ] Timestamps show correctly

### Connection Management
- [ ] Disconnect button stops receiving messages
- [ ] Reconnect button restores connection
- [ ] Auto-connect works on app restart
- [ ] Connection errors show helpful messages

## Troubleshooting

### Bot Not Receiving Messages
**Problem**: Bot connects but doesn't receive messages
**Solution**: 
1. Verify "MESSAGE CONTENT INTENT" is enabled in Discord Developer Portal
2. Make sure bot has "Read Messages" permission in the channel
3. Check that the channel ID is correct

### Connection Fails
**Problem**: "Connection failed" error
**Solution**:
1. Verify bot token is correct (no extra spaces)
2. Verify channel ID is numeric and valid
3. Make sure bot is invited to the server
4. Check internet connection

### Messages Not Sending
**Problem**: Can't send messages to Discord
**Solution**:
1. Verify bot has "Send Messages" permission
2. Check connection status indicator
3. Try reconnecting
4. Verify channel ID is correct

### Bot Shows Offline
**Problem**: Bot appears offline in Discord
**Solution**:
1. Reconnect the bot in the app
2. Check if token is still valid
3. Verify bot wasn't removed from server

## Technical Details

### Discord.Net Library
- **Version**: 3.16.0
- **Features Used**: 
  - DiscordSocketClient for real-time WebSocket connection
  - Gateway Intents for message content
  - Event-based message handling

### Architecture
```
ChatView (UI)
    ?
DiscordService (Service Layer)
    ?
Discord.Net Client (Library)
    ?
Discord Gateway API (Discord's servers)
```

### Event Flow
1. User types message in ChatView
2. Message sent via DiscordService.SendChannelMessageAsync()
3. Discord bot posts to channel
4. Discord Gateway pushes message to all connected clients
5. DiscordService receives MessageReceived event
6. Event handler updates ChatView UI on main thread

## Performance Notes
- Message latency: < 1 second typically
- Memory usage: ~50MB additional for Discord.Net
- CPU usage: Minimal (< 1% idle, < 5% active)

## Security Notes
- Bot token stored in local file (NOT encrypted)
- Recommended: Use environment variables for production
- Never commit discord_settings.json to version control
- Limit bot permissions to only what's needed

## Future Enhancements
- [ ] Message editing support
- [ ] Message deletion support
- [ ] Reactions/emojis support
- [ ] File attachment support
- [ ] User avatar display
- [ ] Rich embeds for bookings
- [ ] Multiple channel support
- [ ] Message search/filter

## Support Resources
- Discord.Net Documentation: https://docs.discordnet.dev/
- Discord Developer Portal: https://discord.com/developers/
- Discord API Documentation: https://discord.com/developers/docs/
