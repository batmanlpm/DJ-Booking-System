# ?? Complete Fix Guide - All Three Issues

## ?? PREREQUISITE: Close the Application First!
**You MUST close DJBookingSystem.exe before proceeding!**

---

## Issue #1: Fix Build Errors in CandyBotDesktopWidget.xaml.cs

### Problem
File has incomplete edits causing compilation errors with `Thickness` constructors and missing methods.

### Solution

#### Step 1: Fix Thickness Constructor Syntax

Open `CandyBotDesktopWidget.xaml.cs` and use Find & Replace:

**Find**: `new Thickness(10, 5)`  
**Replace With**: `new Thickness(10, 5, 10, 5)`

**Find**: `new Thickness(10, 4)`  
**Replace With**: `new Thickness(10, 4, 10, 4)`

**Find**: `new Thickness(0)`  
**Replace With**: `new Thickness(0, 0, 0, 0)`

#### Step 2: Complete the QuickSearch Method

Find the incomplete line:
```csharp
private void QuickSearch(string category
```

Replace it with:
```csharp
private void QuickSearch(string category)
{
    try
    {
        var searchWindow = new MultiDriveSearchWindow();
        searchWindow.Show();
        _tts.SpeakAsync($"Opening quick search for {category}!");
    }
    catch
    {
        MessageBox.Show($"{category.ToUpper()} Search\n\nOpening file search window...", "Candy-Bot");
    }
}
```

---

## Issue #2: Remove ALL `?` Characters

### Files with `?` Characters

#### File 1: Controls\CandyBotAvatar.xaml

**Location 1 - Line 185**: Checkmark icon
```xaml
<!-- FIND THIS: -->
<TextBlock Text="?" FontWeight="Bold" Foreground="#FF69B4"/>

<!-- REPLACE WITH: -->
<TextBlock Text="?" FontWeight="Bold" Foreground="#FF69B4"/>
```

**Location 2 - Lines 504-516**: Sparkle animations
```xaml
<!-- FIND THESE 3 BLOCKS: -->
<TextBlock x:Name="Sparkle1"
          Text="?"
          FontSize="16"
          Canvas.Left="60"
          Canvas.Top="5"
          Opacity="0"/>
<TextBlock x:Name="Sparkle2"
          Text="?"
          FontSize="16"
          Canvas.Left="5"
          Canvas.Top="60"
          Opacity="0"/>
<TextBlock x:Name="Sparkle3"
          Text="?"
          FontSize="16"
          Canvas.Left="60"
          Canvas.Top="60"
          Opacity="0"/>

<!-- REPLACE ALL 3 Text="?" WITH: -->
Text="?"
```

#### File 2: CandyBotWindow.xaml

**Location - Line 122**: Help button
```xaml
<!-- FIND THIS: -->
<Button Content="?"

<!-- REPLACE WITH: -->
<Button Content="?"
```

OR if you prefer no emoji, use:
```xaml
<Button Content="Help"
```

### Quick Fix using PowerShell

Run this in PowerShell from project root:

```powershell
# Fix sparkles in CandyBotAvatar.xaml
$file = "Controls\CandyBotAvatar.xaml"
$content = Get-Content $file -Raw
$content = $content -replace 'Text="\?"', 'Text="?"'
$content = $content -replace '<TextBlock Text="\?" FontWeight="Bold"', '<TextBlock Text="?" FontWeight="Bold"'
Set-Content $file -Value $content

# Fix help button in CandyBotWindow.xaml
$file2 = "CandyBotWindow.xaml"
$content2 = Get-Content $file2 -Raw
$content2 = $content2 -replace 'Content="\?"', 'Content="?"'
Set-Content $file2 -Value $content2

Write-Host "? All question marks replaced!" -ForegroundColor Green
```

---

## Issue #3: Fix White Strip in Desktop Widget Context Menu

### Problem
The context menu in CandyBotDesktopWidget still has a white column on the left.

### Solution

The XAML styles are already added. Now update the C# code to use them properly.

In `CandyBotDesktopWidget.xaml.cs`, find the `SetupContextMenuWithIcons()` method and make sure the menu items don't have manual `MouseEnter`/`MouseLeave` handlers since the style already handles highlighting.

**Remove these blocks from ALL menu items**:
```csharp
// DELETE THESE:
item.MouseEnter += (s, e) =>
{
    item.Foreground = Brushes.Black;
    item.Background = new SolidColorBrush(Color.FromRgb(255, 105, 180));
};
item.MouseLeave += (s, e) =>
{
    item.Foreground = new SolidColorBrush(Color.FromRgb(255, 105, 180));
    item.Background = new SolidColorBrush(Color.FromRgb(26, 26, 26));
};
```

The style template in XAML already handles the highlighting via the `IsHighlighted` trigger.

---

## Issue #4: Fix Left-Click Diagonal Movement

### Problem
Clicking the desktop widget causes it to jump diagonally.

### Solution

In `CandyBotDesktopWidget.xaml.cs`, update the dragging logic:

**Find**:
```csharp
private void Window_MouseLeftButtonDown(object sender, MouseButtonEventArgs e)
{
    _isDragging = true;
    _clickPosition = e.GetPosition(this);
    this.CaptureMouse();
}
```

**Replace with**:
```csharp
private void Window_MouseLeftButtonDown(object sender, MouseButtonEventArgs e)
{
    _isDragging = false; // Don't set true immediately
    _clickPosition = e.GetPosition(this);
    this.CaptureMouse();
}
```

**Find**:
```csharp
private void Window_MouseMove(object sender, MouseEventArgs e)
{
    if (_isDragging && e.LeftButton == MouseButtonState.Pressed)
    {
        var currentPosition = PointToScreen(e.GetPosition(this));
        this.Left = currentPosition.X - _clickPosition.X;
        this.Top = currentPosition.Y - _clickPosition.Y;
    }
}
```

**Replace with**:
```csharp
private void Window_MouseMove(object sender, MouseEventArgs e)
{
    if (e.LeftButton == MouseButtonState.Pressed && Mouse.Captured == this)
    {
        var currentPosition = e.GetPosition(this);
        var distance = Math.Abs(currentPosition.X - _clickPosition.X) + 
                      Math.Abs(currentPosition.Y - _clickPosition.Y);
        
        // Only start dragging if mouse has moved more than 5 pixels
        if (distance > 5 || _isDragging)
        {
            _isDragging = true;
            var screenPosition = PointToScreen(currentPosition);
            this.Left = screenPosition.X - _clickPosition.X;
            this.Top = screenPosition.Y - _clickPosition.Y;
        }
    }
}
```

---

## Complete Checklist

- [ ] **Close the application**
- [ ] **Fix Thickness constructors** (Find & Replace)
- [ ] **Complete QuickSearch method**
- [ ] **Replace ? with ? in sparkles** (CandyBotAvatar.xaml)
- [ ] **Replace ? with ? for checkmark** (CandyBotAvatar.xaml)
- [ ] **Replace ? with ? in help button** (CandyBotWindow.xaml)
- [ ] **Remove MouseEnter/MouseLeave handlers** (Let style handle it)
- [ ] **Fix left-click diagonal movement** (Update dragging logic)
- [ ] **Build the solution**
- [ ] **Test all features**

---

## Quick PowerShell Script to Fix Everything

Save this as `FixAllIssues.ps1` and run it:

```powershell
Write-Host "=== Fixing All Issues ===" -ForegroundColor Cyan

# 1. Fix sparkles and checkmarks
Write-Host "`n[1/4] Fixing question marks..." -ForegroundColor Yellow
$avatar = "Controls\CandyBotAvatar.xaml"
$content = Get-Content $avatar -Raw
$content = $content -replace 'Text="\?"(?![^<]*FontWeight="Bold")', 'Text="?"'
$content = $content -replace '<TextBlock Text="\?" FontWeight="Bold"', '<TextBlock Text="?" FontWeight="Bold"'
Set-Content $avatar -Value $content

$window = "CandyBotWindow.xaml"
$content2 = Get-Content $window -Raw
$content2 = $content2 -replace 'Content="\?"', 'Content="?"'
Set-Content $window -Value $content2

# 2. Fix Thickness constructors
Write-Host "[2/4] Fixing Thickness constructors..." -ForegroundColor Yellow
$desktopCS = "CandyBotDesktopWidget.xaml.cs"
$content3 = Get-Content $desktopCS -Raw
$content3 = $content3 -replace 'new Thickness\(10, 5\)(?!,)', 'new Thickness(10, 5, 10, 5)'
$content3 = $content3 -replace 'new Thickness\(10, 4\)(?!,)', 'new Thickness(10, 4, 10, 4)'
$content3 = $content3 -replace 'new Thickness\(0\)(?!,)', 'new Thickness(0, 0, 0, 0)'
Set-Content $desktopCS -Value $content3

Write-Host "[3/4] Please manually complete the QuickSearch method" -ForegroundColor Yellow
Write-Host "      Find: 'private void QuickSearch(string category'" -ForegroundColor Gray
Write-Host "      Add the closing method body shown in the guide" -ForegroundColor Gray

Write-Host "[4/4] Please manually update the dragging logic" -ForegroundColor Yellow
Write-Host "      See the guide for Window_MouseMove changes" -ForegroundColor Gray

Write-Host "`n? Automated fixes complete!" -ForegroundColor Green
Write-Host "  Complete the manual steps above, then build!" -ForegroundColor Cyan
```

---

## Expected Results After All Fixes

? **Build succeeds** with no errors  
? **No `?` characters** anywhere in the UI  
? **Sparkles show as ?** instead of `?`  
? **Checkmarks show as ?** instead of `?`  
? **Help button shows ?** or "Help" instead of `?`  
? **Desktop widget context menu** has no white strip  
? **Highlighted menu items** have black text on pink background  
? **Left-click** doesn't move the widget (only dragging does)  
? **Bobbing animation** works without clipping  

---

**Time Estimate**: 10-15 minutes  
**Difficulty**: Medium  
**Status**: Ready to implement

