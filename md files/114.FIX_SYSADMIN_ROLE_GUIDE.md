# Fix SysAdmin Role - Quick Guide

## The Real Issue

Your user account in the database likely has:
```csharp
Role = 0  // This is UserRole.User (the default)
```

But it should be:
```csharp
Role = 4  // This is UserRole.SysAdmin
```

## Quick Fix Options

### Option 1: Update in Cosmos DB (Recommended)

1. Open **Azure Portal** or **Cosmos DB Emulator**
2. Navigate to your **Users** container
3. Find your user document (username: "sysadmin" or whatever you're using)
4. Edit the document and change:
   ```json
   {
     "Role": 4
   }
   ```
5. Save and restart the app

### Option 2: Add a Debug Method (Temporary)

Add this to your `MainWindow.xaml.cs`:

```csharp
private async void FixMyRoleToSysAdmin()
{
    try
    {
        if (_currentUser != null && _cosmosDbService != null)
        {
            // Get current role
            var oldRole = _currentUser.Role;
            
            // Set to SysAdmin
            _currentUser.Role = Models.UserRole.SysAdmin;
            
            // Update in database
            await _cosmosDbService.UpdateUserAsync(_currentUser.Id, _currentUser);
            
            MessageBox.Show(
                $"Role updated!\n\n" +
                $"Old role: {oldRole}\n" +
                $"New role: {_currentUser.Role}\n\n" +
                "You now have full SysAdmin access!",
                "Role Updated",
                MessageBoxButton.OK,
                MessageBoxImage.Information);
                
            // Apply permissions immediately
            ApplyPermissions();
        }
    }
    catch (Exception ex)
    {
        MessageBox.Show(
            $"Failed to update role: {ex.Message}",
            "Error",
            MessageBoxButton.OK,
            MessageBoxImage.Error);
    }
}
```

Then call it from somewhere (like a temporary button or menu item).

### Option 3: Create a Proper SysAdmin Account

If you need to create a fresh SysAdmin account, use this code in your database initialization:

```csharp
var sysAdmin = new User
{
    Id = Guid.NewGuid().ToString(),
    Username = "sysadmin",
    PasswordHash = HashPassword("YourSecurePassword123!"),
    FullName = "System Administrator",
    Email = "admin@djbooking.com",
    Role = UserRole.SysAdmin,  // ? This is the critical line!
    IsActive = true,
    IsDJ = false,
    IsVenueOwner = false,
    CreatedAt = DateTime.Now,
    Permissions = PermissionService.GetDefaultPermissionsForRole(UserRole.SysAdmin)
};

await _cosmosDbService.CreateUserAsync(sysAdmin);
```

## UserRole Enum Values

For reference, here are the role values:

```csharp
public enum UserRole
{
    User = 0,         // Basic user (default)
    DJ = 1,           // DJ privileges
    VenueOwner = 2,   // Venue management
    Manager = 3,      // Can moderate + manage users
    SysAdmin = 4      // Full system access (highest)
}
```

## After Fixing

Once you fix your role to SysAdmin:

1. ? You'll have access to ALL moderation features
2. ? You can create/edit/delete users
3. ? You can manage permissions
4. ? You can view audit logs
5. ? You can access error reports
6. ? Everything will work as intended!

## Check Current Role

Add this to a button click or startup code to see your actual role:

```csharp
MessageBox.Show(
    $"Username: {_currentUser.Username}\n" +
    $"Role: {_currentUser.Role}\n" +
    $"Role Value: {(int)_currentUser.Role}\n\n" +
    $"Expected for SysAdmin: {UserRole.SysAdmin} (value: 4)",
    "Current Role Info",
    MessageBoxButton.OK,
    MessageBoxImage.Information);
```

---

**The permission checks are now correct.** They properly recognize SysAdmin as having all permissions. You just need to fix your user's role in the database!
