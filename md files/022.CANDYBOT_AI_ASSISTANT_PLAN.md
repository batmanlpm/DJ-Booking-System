# ?? Candy-Bot AI Assistant Integration Plan

## ?? Overview

**Candy-Bot** - An intelligent AI assistant integrated into the DJ Booking System that can help users with:
- Booking questions and guidance
- Venue recommendations
- DJ tips and best practices
- Troubleshooting
- Navigation help
- Real-time chat support

---

## ?? Implementation Strategy

### Phase 1: Backend AI Integration (Choose One)

#### Option A: **Azure OpenAI Service** (Recommended)
**Pros:**
- Enterprise-grade security
- Already using Azure Cosmos DB
- GDPR compliant
- Customizable models
- Fine-tuning capabilities

**Setup:**
```csharp
// Install Package
// Install-Package Azure.AI.OpenAI

public class CandyBotService
{
    private readonly OpenAIClient _client;
    private const string SYSTEM_PROMPT = @"
        You are Candy-Bot, a friendly AI assistant for The Fallen Collective DJ Booking System.
        You help DJs book slots, find venues, and answer questions about the platform.
        You are knowledgeable, helpful, and have a fun personality.
        Always be encouraging and supportive to DJs.
    ";

    public CandyBotService(string endpoint, string apiKey)
    {
        _client = new OpenAIClient(new Uri(endpoint), new AzureKeyCredential(apiKey));
    }

    public async Task<string> GetResponseAsync(string userMessage, string context = "")
    {
        var chatMessages = new[]
        {
            new ChatMessage(ChatRole.System, SYSTEM_PROMPT),
            new ChatMessage(ChatRole.User, $"Context: {context}\n\nUser: {userMessage}")
        };

        var response = await _client.GetChatCompletionsAsync(
            deploymentOrModelName: "gpt-4",
            new ChatCompletionsOptions(chatMessages)
            {
                Temperature = 0.7f,
                MaxTokens = 500
            });

        return response.Value.Choices[0].Message.Content;
    }
}
```

#### Option B: **OpenAI API** (Simpler)
```csharp
// Install-Package OpenAI

public class CandyBotService
{
    private readonly OpenAIAPI _api;

    public CandyBotService(string apiKey)
    {
        _api = new OpenAIAPI(apiKey);
    }

    public async Task<string> AskCandyBotAsync(string question)
    {
        var chat = _api.Chat.CreateConversation();
        chat.AppendSystemMessage("You are Candy-Bot, a helpful AI assistant for DJs...");
        chat.AppendUserInput(question);
        
        return await chat.GetResponseFromChatbotAsync();
    }
}
```

#### Option C: **Local AI Model** (Offline Support)
Using Semantic Kernel + Local LLM:
```csharp
// Install-Package Microsoft.SemanticKernel

public class CandyBotLocalService
{
    private readonly IKernel _kernel;

    public CandyBotLocalService()
    {
        _kernel = Kernel.Builder
            .WithOllamaTextCompletion("llama2", "http://localhost:11434")
            .Build();
    }

    public async Task<string> AskAsync(string question)
    {
        var prompt = $"As Candy-Bot, a DJ booking assistant: {question}";
        return await _kernel.RunAsync(prompt);
    }
}
```

---

## ?? Phase 2: UI Implementation

### A. Candy-Bot Chat Window

```xaml
<!-- CandyBotWindow.xaml -->
<Window x:Class="DJBookingSystem.CandyBotWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="?? Candy-Bot AI Assistant" 
        Height="600" 
        Width="450"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize">
    
    <Border Background="#0A0A0A" 
            BorderBrush="#FF69B4" 
            BorderThickness="2" 
            CornerRadius="15">
        <Border.Effect>
            <DropShadowEffect Color="#FF69B4" BlurRadius="20" ShadowDepth="0" Opacity="0.6"/>
        </Border.Effect>
        
        <Grid Margin="15">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Header -->
                <RowDefinition Height="*"/>    <!-- Chat History -->
                <RowDefinition Height="Auto"/> <!-- Quick Actions -->
                <RowDefinition Height="Auto"/> <!-- Input Box -->
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" 
                    Background="#1A1A1A" 
                    CornerRadius="10" 
                    Padding="15"
                    Margin="0,0,0,10">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <TextBlock Text="??" FontSize="32" Margin="0,0,10,0"/>
                        <StackPanel>
                            <TextBlock Text="Candy-Bot" 
                                      FontSize="22" 
                                      FontWeight="Bold" 
                                      Foreground="#FF69B4"
                                      FontFamily="Consolas"/>
                            <TextBlock Text="Your AI DJ Assistant" 
                                      FontSize="12" 
                                      Foreground="#888888"
                                      FontFamily="Consolas"/>
                        </StackPanel>
                        <Button Content="?" 
                               Click="Close_Click"
                               Style="{StaticResource CloseButtonStyle}"
                               Margin="20,0,0,0"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Chat History -->
            <ScrollViewer Grid.Row="1" 
                         x:Name="ChatScrollViewer"
                         VerticalScrollBarVisibility="Auto"
                         Background="#000000"
                         Margin="0,0,0,10">
                <ItemsControl x:Name="ChatHistoryItems" Padding="10">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{Binding Background}"
                                   BorderBrush="{Binding BorderBrush}"
                                   BorderThickness="2"
                                   CornerRadius="10"
                                   Padding="12"
                                   Margin="5">
                                <StackPanel>
                                    <TextBlock Text="{Binding Sender}" 
                                              FontWeight="Bold" 
                                              Foreground="{Binding SenderColor}"
                                              FontFamily="Consolas"
                                              FontSize="11"
                                              Margin="0,0,0,5"/>
                                    <TextBlock Text="{Binding Message}" 
                                              TextWrapping="Wrap"
                                              Foreground="#FFFFFF"
                                              FontFamily="Consolas"
                                              FontSize="13"/>
                                    <TextBlock Text="{Binding Timestamp}" 
                                              FontSize="9" 
                                              Foreground="#666666"
                                              HorizontalAlignment="Right"
                                              Margin="0,5,0,0"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>

            <!-- Quick Action Buttons -->
            <WrapPanel Grid.Row="2" 
                      Orientation="Horizontal" 
                      HorizontalAlignment="Center"
                      Margin="0,0,0,10">
                <Button Content="?? Book a Slot" 
                       Click="QuickAction_BookSlot"
                       Style="{StaticResource QuickActionButtonStyle}"/>
                <Button Content="??? Find Venues" 
                       Click="QuickAction_FindVenues"
                       Style="{StaticResource QuickActionButtonStyle}"/>
                <Button Content="?? Tips" 
                       Click="QuickAction_GetTips"
                       Style="{StaticResource QuickActionButtonStyle}"/>
                <Button Content="? Help" 
                       Click="QuickAction_GetHelp"
                       Style="{StaticResource QuickActionButtonStyle}"/>
            </WrapPanel>

            <!-- Input Box -->
            <Grid Grid.Row="3">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox x:Name="UserInputTextBox"
                        Grid.Column="0"
                        Height="50"
                        Padding="15,12"
                        FontFamily="Consolas"
                        FontSize="14"
                        Background="#1A1A1A"
                        Foreground="#FFFFFF"
                        BorderBrush="#FF69B4"
                        BorderThickness="2"
                        CaretBrush="#FF69B4"
                        VerticalContentAlignment="Center"
                        KeyDown="UserInput_KeyDown"
                        TextWrapping="Wrap"/>

                <Button Grid.Column="1"
                       Content="?? Send"
                       Click="SendMessage_Click"
                       Width="100"
                       Height="50"
                       Margin="10,0,0,0"
                       Background="#FF69B4"
                       Foreground="#000000"
                       FontFamily="Consolas"
                       FontSize="14"
                       FontWeight="Bold"
                       BorderThickness="0"
                       Cursor="Hand">
                    <Button.Effect>
                        <DropShadowEffect Color="#FF69B4" BlurRadius="15" ShadowDepth="0"/>
                    </Button.Effect>
                </Button>
            </Grid>
        </Grid>
    </Border>
</Window>
```

### B. Code-Behind for Candy-Bot Window

```csharp
// CandyBotWindow.xaml.cs
using System;
using System.Collections.ObjectModel;
using System.Windows;
using System.Windows.Input;

namespace DJBookingSystem
{
    public partial class CandyBotWindow : Window
    {
        private readonly CandyBotService _candyBot;
        private readonly ObservableCollection<ChatMessage> _chatHistory;
        private readonly User _currentUser;

        public CandyBotWindow(User currentUser, CandyBotService candyBot)
        {
            InitializeComponent();
            _currentUser = currentUser;
            _candyBot = candyBot;
            _chatHistory = new ObservableCollection<ChatMessage>();
            ChatHistoryItems.ItemsSource = _chatHistory;

            // Welcome message
            AddBotMessage($"?? Hi {currentUser.FullName}! I'm Candy-Bot, your AI assistant. How can I help you today?");
        }

        private async void SendMessage_Click(object sender, RoutedEventArgs e)
        {
            await SendUserMessageAsync();
        }

        private async void UserInput_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.Key == Key.Enter && !Keyboard.Modifiers.HasFlag(ModifierKeys.Shift))
            {
                e.Handled = true;
                await SendUserMessageAsync();
            }
        }

        private async Task SendUserMessageAsync()
        {
            string userMessage = UserInputTextBox.Text.Trim();
            if (string.IsNullOrEmpty(userMessage)) return;

            // Add user message to chat
            AddUserMessage(userMessage);
            UserInputTextBox.Clear();

            // Show typing indicator
            AddBotMessage("?? Thinking...");

            try
            {
                // Get context about user's current state
                string context = $"User: {_currentUser.FullName}, Role: {_currentUser.Role}";

                // Get AI response
                string response = await _candyBot.GetResponseAsync(userMessage, context);

                // Remove typing indicator
                _chatHistory.RemoveAt(_chatHistory.Count - 1);

                // Add bot response
                AddBotMessage(response);
            }
            catch (Exception ex)
            {
                _chatHistory.RemoveAt(_chatHistory.Count - 1);
                AddBotMessage($"?? Oops! I encountered an error: {ex.Message}");
            }

            // Scroll to bottom
            ChatScrollViewer.ScrollToBottom();
        }

        private void AddUserMessage(string message)
        {
            _chatHistory.Add(new ChatMessage
            {
                Sender = "You",
                SenderColor = "#00FF00",
                Message = message,
                Timestamp = DateTime.Now.ToString("HH:mm"),
                Background = "#001100",
                BorderBrush = "#00FF00"
            });
        }

        private void AddBotMessage(string message)
        {
            _chatHistory.Add(new ChatMessage
            {
                Sender = "?? Candy-Bot",
                SenderColor = "#FF69B4",
                Message = message,
                Timestamp = DateTime.Now.ToString("HH:mm"),
                Background = "#1A0A10",
                BorderBrush = "#FF69B4"
            });
        }

        // Quick Actions
        private async void QuickAction_BookSlot(object sender, RoutedEventArgs e)
        {
            AddUserMessage("How do I book a DJ slot?");
            await SendUserMessageAsync();
        }

        private async void QuickAction_FindVenues(object sender, RoutedEventArgs e)
        {
            AddUserMessage("What venues are available?");
            await SendUserMessageAsync();
        }

        private async void QuickAction_GetTips(object sender, RoutedEventArgs e)
        {
            AddUserMessage("Give me some DJ tips");
            await SendUserMessageAsync();
        }

        private async void QuickAction_GetHelp(object sender, RoutedEventArgs e)
        {
            AddUserMessage("I need help navigating the system");
            await SendUserMessageAsync();
        }

        private void Close_Click(object sender, RoutedEventArgs e)
        {
            this.Close();
        }
    }

    // Chat Message Model
    public class ChatMessage
    {
        public string Sender { get; set; } = "";
        public string SenderColor { get; set; } = "#FFFFFF";
        public string Message { get; set; } = "";
        public string Timestamp { get; set; } = "";
        public string Background { get; set; } = "#1A1A1A";
        public string BorderBrush { get; set; } = "#00FF00";
    }
}
```

---

## ?? Phase 3: Integration Points

### 1. Add Menu Item to MainWindow

```xaml
<!-- In MainWindow.xaml Menu Bar -->
<MenuItem Header="_Help" Style="{StaticResource FuturisticMenuItemStyle}">
    <MenuItem Header="?? _Candy-Bot Assistant" Click="CandyBot_Click" Style="{StaticResource FuturisticMenuItemStyle}"/>
    <Separator Background="#00FF00" Margin="2"/>
    <MenuItem Header="_Help Guide" Click="HelpGuide_Click" Style="{StaticResource FuturisticMenuItemStyle}"/>
    <MenuItem Header="_About" Click="About_Click" Style="{StaticResource FuturisticMenuItemStyle}"/>
</MenuItem>
```

```csharp
// In MainWindow.xaml.cs
private void CandyBot_Click(object sender, RoutedEventArgs e)
{
    try
    {
        var candyBotService = new CandyBotService(
            endpoint: "YOUR_AZURE_OPENAI_ENDPOINT",
            apiKey: "YOUR_API_KEY"
        );
        
        var candyBotWindow = new CandyBotWindow(_currentUser, candyBotService);
        candyBotWindow.Show();
    }
    catch (Exception ex)
    {
        MessageBox.Show($"Failed to open Candy-Bot: {ex.Message}", 
            "Error", MessageBoxButton.OK, MessageBoxImage.Error);
    }
}
```

### 2. Floating Candy-Bot Button (Always Accessible)

```xaml
<!-- Add to MainWindow.xaml Grid (highest ZIndex) -->
<Button x:Name="CandyBotFloatingButton"
        Grid.Row="4"
        Content="??"
        Click="CandyBot_Click"
        Width="60"
        Height="60"
        HorizontalAlignment="Right"
        VerticalAlignment="Bottom"
        Margin="0,0,20,20"
        Panel.ZIndex="9999"
        Background="#FF69B4"
        Foreground="#FFFFFF"
        FontSize="32"
        BorderThickness="3"
        BorderBrush="#FFFFFF"
        Cursor="Hand"
        ToolTip="Ask Candy-Bot">
    <Button.Style>
        <Style TargetType="Button">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                               BorderBrush="{TemplateBinding BorderBrush}"
                               BorderThickness="{TemplateBinding BorderThickness}"
                               CornerRadius="30">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="#FF69B4" BlurRadius="30" ShadowDepth="0" Opacity="1"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Button.Style>
</Button>
```

---

## ?? Phase 4: Advanced Features

### Context-Aware Responses

```csharp
public class CandyBotService
{
    public async Task<string> GetContextualResponseAsync(
        string userMessage, 
        User currentUser,
        string currentPage,
        List<Venue> availableVenues,
        List<Booking> userBookings)
    {
        // Build rich context
        var context = $@"
            Current User: {currentUser.FullName}
            Role: {currentUser.Role}
            Current Page: {currentPage}
            User's Bookings Count: {userBookings.Count}
            Available Venues: {string.Join(", ", availableVenues.Select(v => v.Name))}
        ";

        // Add conversation history
        var messages = new List<ChatMessage>
        {
            new ChatMessage(ChatRole.System, SYSTEM_PROMPT),
            new ChatMessage(ChatRole.System, $"Context: {context}"),
            new ChatMessage(ChatRole.User, userMessage)
        };

        // Get response
        var response = await _client.GetChatCompletionsAsync(
            "gpt-4",
            new ChatCompletionsOptions(messages)
        );

        return response.Value.Choices[0].Message.Content;
    }
}
```

### Booking Assistant Actions

```csharp
public class CandyBotActions
{
    private readonly CosmosDbService _db;
    private readonly MainWindow _mainWindow;

    public async Task ExecuteActionAsync(string action, Dictionary<string, string> parameters)
    {
        switch (action.ToLower())
        {
            case "book_slot":
                var venue = parameters["venue"];
                var date = DateTime.Parse(parameters["date"]);
                // Navigate to booking page
                _mainWindow.NavigateToBooking(venue, date);
                break;

            case "show_venues":
                _mainWindow.ShowVenuesTab();
                break;

            case "my_bookings":
                _mainWindow.ShowMyBookings();
                break;

            case "search_venue":
                var searchTerm = parameters["term"];
                var venues = await _db.SearchVenuesAsync(searchTerm);
                return JsonConvert.SerializeObject(venues);
        }
    }
}
```

---

## ?? Cost Estimation

### Azure OpenAI (Recommended)
- **GPT-4**: ~$0.03 per 1K tokens
- **Average conversation**: ~500 tokens
- **Cost per query**: ~$0.015
- **100 queries/day**: ~$1.50/day = **$45/month**

### OpenAI API
- **GPT-3.5-Turbo**: ~$0.002 per 1K tokens (cheaper)
- **100 queries/day**: ~$3/month

### Local AI (Offline)
- **Free** but requires:
  - Powerful PC (GPU recommended)
  - ~8GB RAM for model
  - Setup complexity

---

## ?? Implementation Timeline

| Phase | Task | Time | Priority |
|-------|------|------|----------|
| 1 | Create CandyBotService | 2 hours | High |
| 2 | Design CandyBotWindow UI | 3 hours | High |
| 3 | Implement chat functionality | 4 hours | High |
| 4 | Add context awareness | 3 hours | Medium |
| 5 | Integrate action execution | 3 hours | Medium |
| 6 | Add floating button | 1 hour | Low |
| 7 | Testing & refinement | 4 hours | High |
| **Total** | | **20 hours** | |

---

## ?? Design Mockup

```
????????????????????????????????????????????
?  ?? Candy-Bot         Your AI DJ Assistant  ??
????????????????????????????????????????????
?                                          ?
?  ?????????????????????????????????????? ?
?  ? ?? Candy-Bot                10:45 ? ?
?  ? Hi! How can I help you today?     ? ?
?  ?????????????????????????????????????? ?
?                                          ?
?              ?????????????????????????????
?              ? You                10:46??
?              ? How do I book a slot?   ??
?              ?????????????????????????????
?                                          ?
?  ?????????????????????????????????????? ?
?  ? ?? Candy-Bot                10:46 ? ?
?  ? Sure! To book a DJ slot:          ? ?
?  ? 1. Click "? Book New Slot"       ? ?
?  ? 2. Select a venue                 ? ?
?  ? 3. Pick your date & time          ? ?
?  ? Would you like me to guide you?   ? ?
?  ?????????????????????????????????????? ?
?                                          ?
????????????????????????????????????????????
? [?? Book][??? Venues][?? Tips][? Help] ?
????????????????????????????????????????????
? [Type your message here...      ] [?? Send]?
????????????????????????????????????????????
```

---

## ? Benefits

1. **24/7 Support** - Always available to help users
2. **Reduces Support Load** - Answers common questions automatically
3. **Improves UX** - Instant guidance and help
4. **Increases Engagement** - Fun, interactive experience
5. **Data Insights** - Track common questions/issues
6. **Scalable** - Can handle unlimited users simultaneously

---

## ?? Security Considerations

1. **API Key Protection** - Store in Azure Key Vault
2. **User Privacy** - Don't send sensitive data to AI
3. **Content Filtering** - Implement Azure Content Safety
4. **Rate Limiting** - Prevent abuse
5. **Audit Logging** - Track all AI interactions

---

## ?? Next Steps to Implement

Would you like me to:
1. **Create the full Candy-Bot implementation** (Service + UI)?
2. **Set up Azure OpenAI connection**?
3. **Add the floating button to MainWindow**?
4. **Create the ChatMessage model and styling**?

This would be an **AMAZING feature** that sets your application apart! ????

What would you like me to start with?
