<UserControl x:Class="DJBookingSystem.Controls.CandyBotAvatar"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Width="80" Height="80"
             Background="Transparent"
             MouseEnter="Avatar_MouseEnter"
             MouseLeave="Avatar_MouseLeave"
             MouseRightButtonDown="Avatar_MouseRightButtonDown"
             Cursor="Hand">
    
    <UserControl.Resources>
        <!-- Converter for submenu arrow visibility -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        
        <!-- Idle Bobbing Animation -->
        <Storyboard x:Key="IdleBobAnimation" RepeatBehavior="Forever">
            <DoubleAnimation Storyboard.TargetName="AvatarTransform"
                           Storyboard.TargetProperty="Y"
                           From="0" To="-8" Duration="0:0:1.5"
                           AutoReverse="True">
                <DoubleAnimation.EasingFunction>
                    <SineEase EasingMode="EaseInOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
        
        <!-- Active Bounce Animation -->
        <Storyboard x:Key="ActiveBounceAnimation">
            <DoubleAnimation Storyboard.TargetName="AvatarScale"
                           Storyboard.TargetProperty="ScaleX"
                           From="1" To="1.2" Duration="0:0:0.3"
                           AutoReverse="True">
                <DoubleAnimation.EasingFunction>
                    <BounceEase Bounces="2" EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="AvatarScale"
                           Storyboard.TargetProperty="ScaleY"
                           From="1" To="1.2" Duration="0:0:0.3"
                           AutoReverse="True">
                <DoubleAnimation.EasingFunction>
                    <BounceEase Bounces="2" EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
        
        <!-- Sparkle Animation -->
        <Storyboard x:Key="SparkleAnimation" RepeatBehavior="Forever">
            <DoubleAnimation Storyboard.TargetName="Sparkle1"
                           Storyboard.TargetProperty="Opacity"
                           From="0" To="1" Duration="0:0:0.5"
                           AutoReverse="True"
                           BeginTime="0:0:0"/>
            <DoubleAnimation Storyboard.TargetName="Sparkle2"
                           Storyboard.TargetProperty="Opacity"
                           From="0" To="1" Duration="0:0:0.5"
                           AutoReverse="True"
                           BeginTime="0:0:0.2"/>
            <DoubleAnimation Storyboard.TargetName="Sparkle3"
                           Storyboard.TargetProperty="Opacity"
                           From="0" To="1" Duration="0:0:0.5"
                           AutoReverse="True"
                           BeginTime="0:0:0.4"/>
        </Storyboard>
        
        <!-- Context Menu Style -->
        <Style x:Key="CandyBotMenuStyle" TargetType="ContextMenu">
            <Setter Property="Background" Value="#1A1A1A"/>
            <Setter Property="BorderBrush" Value="#FF69B4"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="FontFamily" Value="Segoe UI Emoji, Consolas"/>
            <Setter Property="HasDropShadow" Value="False"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#FF69B4" BlurRadius="15" ShadowDepth="0" Opacity="0.8"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ContextMenu">
                        <Border Background="#1A1A1A"
                                BorderBrush="#FF69B4"
                                BorderThickness="2"
                                Margin="0"
                                Padding="0"
                                SnapsToDevicePixels="True">
                            <ScrollViewer Style="{DynamicResource {ComponentResourceKey ResourceId=MenuScrollViewer, TypeInTargetAssembly={x:Type FrameworkElement}}}">
                                <ItemsPresenter Margin="0" 
                                              SnapsToDevicePixels="True"
                                              KeyboardNavigation.DirectionalNavigation="Cycle"/>
                            </ScrollViewer>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style x:Key="CandyBotMenuItemStyle" TargetType="MenuItem">
            <Setter Property="Background" Value="#1A1A1A"/>
            <Setter Property="Foreground" Value="#FF69B4"/>
            <Setter Property="FontFamily" Value="Segoe UI Emoji, Consolas"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border x:Name="Border"
                                Background="#1A1A1A"
                                BorderBrush="Transparent"
                                BorderThickness="0"
                                Margin="0"
                                Padding="{TemplateBinding Padding}">
                            <Grid Background="#1A1A1A" Margin="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" MinWidth="20"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Checkmark/Icon Column (hidden but reserves space) -->
                                <ContentPresenter Grid.Column="0"
                                                Content="{TemplateBinding Icon}"
                                                Margin="0"
                                                Width="20"
                                                VerticalAlignment="Center"/>
                                
                                <!-- Header Content -->
                                <ContentPresenter Grid.Column="1"
                                                ContentSource="Header"
                                                Margin="0"
                                                VerticalAlignment="Center"
                                                TextBlock.Foreground="{TemplateBinding Foreground}"/>
                                
                                <!-- Submenu Arrow -->
                                <TextBlock Grid.Column="2"
                                          Text=">"
                                          FontSize="12"
                                          FontWeight="Bold"
                                          Foreground="{TemplateBinding Foreground}"
                                          Margin="15,0,5,0"
                                          VerticalAlignment="Center"
                                          Visibility="{Binding HasItems, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                
                                <!-- Submenu Popup -->
                                <Popup x:Name="PART_Popup"
                                      AllowsTransparency="True"
                                      Placement="Right"
                                      IsOpen="{Binding IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}"
                                      Focusable="False"
                                      PopupAnimation="Fade"
                                      HorizontalOffset="-2"
                                      VerticalOffset="-5">
                                    <Border Background="#1A1A1A"
                                           BorderBrush="#FF69B4"
                                           BorderThickness="2"
                                           Margin="0"
                                           Padding="0">
                                        <Border.Effect>
                                            <DropShadowEffect Color="#FF69B4" BlurRadius="15" ShadowDepth="0" Opacity="0.8"/>
                                        </Border.Effect>
                                        <StackPanel IsItemsHost="True"
                                                   Margin="0"
                                                   Background="#1A1A1A"/>
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                        
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#FF69B4"/>
                                <Setter Property="Foreground" Value="#000000"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="#666666"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter Property="Icon">
                                    <Setter.Value>
                                        <TextBlock Text="?" FontWeight="Bold" Foreground="#FF69B4"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Separator Style -->
        <Style x:Key="CandyBotSeparatorStyle" TargetType="Separator">
            <Setter Property="Background" Value="#FF69B4"/>
            <Setter Property="Height" Value="2"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Separator">
                        <Border Background="#FF69B4" 
                                Height="2" 
                                Margin="0"
                                SnapsToDevicePixels="True"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>
    
    <!-- Context Menu -->
    <UserControl.ContextMenu>
        <ContextMenu Style="{StaticResource CandyBotMenuStyle}">
            <!-- Desktop Mode - First Item -->
            <MenuItem Header="Desktop Mode" 
                     Click="DesktopMode_Click"
                     Style="{StaticResource CandyBotMenuItemStyle}"
                     Foreground="#FF69B4"
                     FontWeight="Bold"
                     ToolTip="Detach to floating desktop widget"/>
            
            <Separator Style="{StaticResource CandyBotSeparatorStyle}"/>
            
            <!-- Quick Actions -->
            <MenuItem Header="Search Web" 
                     Click="SearchWeb_Click"
                     Style="{StaticResource CandyBotMenuItemStyle}"
                     Foreground="#FF69B4"
                     FontWeight="Bold"/>
            <MenuItem Header="Open Chat" 
                     Click="OpenChat_Click"
                     Style="{StaticResource CandyBotMenuItemStyle}"
                     Foreground="#FF69B4"
                     FontWeight="Bold"/>
            <MenuItem Header="Open Knowledge Base" 
                     Click="OpenKnowledge_Click"
                     Style="{StaticResource CandyBotMenuItemStyle}"
                     Foreground="#FF69B4"
                     FontWeight="Bold"/>
            
            <Separator Style="{StaticResource CandyBotSeparatorStyle}"/>
            
            <!-- Personality Modes -->
            <MenuItem Header="Personality Modes" 
                     Style="{StaticResource CandyBotMenuItemStyle}"
                     Foreground="#FF69B4"
                     FontWeight="Bold">
                <MenuItem Header="Normal - Sweet &amp; Balanced" 
                         Click="SetPersonality_Normal"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"/>
                <MenuItem Header="Shy - Timid &amp; Gentle" 
                         Click="SetPersonality_Shy"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"/>
                <MenuItem Header="Funny - Jokes &amp; Puns" 
                         Click="SetPersonality_Funny"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"/>
                <MenuItem Header="Shit-Stirring - Sarcastic" 
                         Click="SetPersonality_ShitStirring"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"/>
                <MenuItem Header="Raunchy - Flirty (18+)" 
                         Click="SetPersonality_Raunchy"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"/>
                <MenuItem Header="Professional - Formal" 
                         Click="SetPersonality_Professional"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"/>
            </MenuItem>
            
            <Separator Style="{StaticResource CandyBotSeparatorStyle}"/>
            
            <!-- Display Options -->
            <MenuItem Header="Display Options" 
                     Style="{StaticResource CandyBotMenuItemStyle}"
                     Foreground="#FF69B4"
                     FontWeight="Bold">
                <MenuItem Header="Always On Top" 
                         x:Name="AlwaysOnTopMenuItem"
                         Click="AlwaysOnTop_Click"
                         IsCheckable="True"
                         IsChecked="True"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"/>
                <MenuItem Header="Start With Windows" 
                         x:Name="StartWithWindowsMenuItem"
                         Click="StartWithWindows_Click"
                         IsCheckable="True"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"/>
            </MenuItem>
            
            <Separator Style="{StaticResource CandyBotSeparatorStyle}"/>
            
            <!-- File Search Features -->
            <MenuItem Header="File Search" 
                     Style="{StaticResource CandyBotMenuItemStyle}"
                     Foreground="#FF69B4"
                     FontWeight="Bold">
                <MenuItem Header="Multi-Drive Search Window" 
                         Click="OpenMultiDriveSearch_Click"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"
                         FontWeight="Bold"
                         ToolTip="Open full-featured search window"/>
                <Separator Style="{StaticResource CandyBotSeparatorStyle}"/>
                <MenuItem Header="Quick Search: Music" 
                         Click="QuickSearch_Music_Click"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"
                         ToolTip=".mp3, .wav, .flac, .m4a, .aac, .ogg"/>
                <MenuItem Header="Quick Search: Documents" 
                         Click="QuickSearch_Documents_Click"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"
                         ToolTip=".pdf, .docx, .txt, .xlsx, .pptx"/>
                <MenuItem Header="Quick Search: Images" 
                         Click="QuickSearch_Images_Click"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"
                         ToolTip=".jpg, .png, .gif, .bmp, .svg"/>
                <MenuItem Header="Quick Search: Videos" 
                         Click="QuickSearch_Videos_Click"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"
                         ToolTip=".mp4, .avi, .mkv, .mov, .wmv"/>
                <MenuItem Header="Quick Search: Archives" 
                         Click="QuickSearch_Archives_Click"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"
                         ToolTip=".zip, .rar, .7z, .tar, .gz"/>
                <MenuItem Header="Quick Search: Code Files" 
                         Click="QuickSearch_Code_Click"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"
                         ToolTip=".cs, .js, .py, .java, .cpp, .html"/>
                <MenuItem Header="Quick Search: .world Files" 
                         Click="QuickSearch_World_Click"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"
                         ToolTip="Minecraft world files"/>
                <Separator Style="{StaticResource CandyBotSeparatorStyle}"/>
                <MenuItem Header="Manage Approved Folders" 
                         Click="ManageApprovedFolders_Click"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"/>
                <MenuItem Header="Approve All Drives" 
                         Click="ApproveAllDrives_Click"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"/>
            </MenuItem>
            
            <Separator Style="{StaticResource CandyBotSeparatorStyle}"/>
            
            <!-- Code & AI Tools -->
            <MenuItem Header="Code &amp; AI Tools" 
                     Style="{StaticResource CandyBotMenuItemStyle}"
                     Foreground="#FF69B4"
                     FontWeight="Bold">
                <MenuItem Header="Code Assistant" 
                         Click="OpenCodeAssistant_Click"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"
                         ToolTip="AI-powered code generation"/>
                <MenuItem Header="Image Generator" 
                         Click="OpenImageGenerator_Click"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"
                         ToolTip="Generate AI images"/>
                <MenuItem Header="Document Generator" 
                         Click="OpenDocumentGenerator_Click"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"
                         ToolTip="Create documents &amp; setlists"/>
            </MenuItem>
            
            <Separator Style="{StaticResource CandyBotSeparatorStyle}"/>
            
            <!-- DJ Bookings -->
            <MenuItem Header="DJ Bookings" 
                     Click="OpenBookings_Click"
                     Style="{StaticResource CandyBotMenuItemStyle}"
                     Foreground="#FF69B4"
                     FontWeight="Bold"
                     ToolTip="Quick access to bookings"/>
            
            <Separator Style="{StaticResource CandyBotSeparatorStyle}"/>
            
            <!-- Audio Options -->
            <MenuItem Header="Audio Options" 
                     Style="{StaticResource CandyBotMenuItemStyle}"
                     Foreground="#FF69B4"
                     FontWeight="Bold">
                <MenuItem Header="Quiet Mode" 
                         x:Name="QuietModeMenuItem"
                         Click="QuietMode_Click"
                         IsCheckable="True"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"
                         ToolTip="Only responds when called upon"/>
                <MenuItem Header="Voice Mode" 
                         x:Name="VoiceModeMenuItem"
                         Click="VoiceMode_Click"
                         IsCheckable="True"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"
                         ToolTip="Enable text-to-speech"/>
                <MenuItem Header="Sounds" 
                         x:Name="SoundsMenuItem"
                         Click="Sounds_Click"
                         IsCheckable="True"
                         IsChecked="True"
                         Style="{StaticResource CandyBotMenuItemStyle}"
                         Foreground="#FF69B4"
                         ToolTip="Enable notification sounds"/>
            </MenuItem>
            
            <Separator Style="{StaticResource CandyBotSeparatorStyle}"/>
            
            <!-- Quick Access -->
            <MenuItem Header="Settings" 
                     Click="OpenSettings_Click"
                     Style="{StaticResource CandyBotMenuItemStyle}"
                     Foreground="#FF69B4"/>
            <MenuItem Header="About Candy-Bot" 
                     Click="About_Click"
                     Style="{StaticResource CandyBotMenuItemStyle}"
                     Foreground="#FF69B4"/>
            
            <Separator Style="{StaticResource CandyBotSeparatorStyle}"/>
            
            <!-- Close Option -->
            <MenuItem Header="Close" 
                     Click="Close_Click"
                     Style="{StaticResource CandyBotMenuItemStyle}"
                     Foreground="#FF69B4"
                     FontWeight="Bold"/>
        </ContextMenu>
    </UserControl.ContextMenu>
    
    <Grid>
        <!-- Glow Effect Background -->
        <Ellipse Width="90" Height="90" 
                HorizontalAlignment="Center" 
                VerticalAlignment="Center">
            <Ellipse.Fill>
                <RadialGradientBrush>
                    <GradientStop Color="Transparent" Offset="0.7"/>
                    <GradientStop Color="#3300FFFF" Offset="1"/>
                </RadialGradientBrush>
            </Ellipse.Fill>
            <Ellipse.Effect>
                <DropShadowEffect x:Name="GlowEffect"
                                Color="#00FFFF" 
                                BlurRadius="20" 
                                ShadowDepth="0" 
                                Opacity="0.6"/>
            </Ellipse.Effect>
        </Ellipse>
        
        <!-- Avatar Container with Transforms -->
        <Grid RenderTransformOrigin="0.5,0.5">
            <Grid.RenderTransform>
                <TransformGroup>
                    <ScaleTransform x:Name="AvatarScale"/>
                    <TranslateTransform x:Name="AvatarTransform"/>
                </TransformGroup>
            </Grid.RenderTransform>
            
            <!-- Main Rainbow Candy Avatar Image -->
            <Image x:Name="AvatarImage"
                   Source="/Resources/Images/CandyBotAvatar.png"
                   Width="80" Height="80"
                   Stretch="UniformToFill"
                   RenderOptions.BitmapScalingMode="HighQuality">
                <Image.Clip>
                    <EllipseGeometry Center="40,40" RadiusX="40" RadiusY="40"/>
                </Image.Clip>
            </Image>
            
            <!-- Status Indicator (bottom right corner) -->
            <Ellipse x:Name="StatusIndicator"
                    Width="16" Height="16"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Bottom"
                    Margin="0,0,8,8"
                    Fill="#00FF00"
                    Stroke="White"
                    StrokeThickness="2">
                <Ellipse.Effect>
                    <DropShadowEffect Color="#00FF00" BlurRadius="8" ShadowDepth="0"/>
                </Ellipse.Effect>
            </Ellipse>
        </Grid>
        
        <!-- Sparkles (only show on hover) -->
        <Canvas>
            <TextBlock x:Name="Sparkle1"
                      Text="?"
                      FontSize="16"
                      Canvas.Left="60"
                      Canvas.Top="5"
                      Opacity="0"/>
            <TextBlock x:Name="Sparkle2"
                      Text="?"
                      FontSize="16"
                      Canvas.Left="5"
                      Canvas.Top="60"
                      Opacity="0"/>
            <TextBlock x:Name="Sparkle3"
                      Text="?"
                      FontSize="16"
                      Canvas.Left="60"
                      Canvas.Top="60"
                      Opacity="0"/>
        </Canvas>
        
        <!-- Notification Badge -->
        <Border x:Name="NotificationBadge"
                Width="20" Height="20"
                Background="#FF0000"
                CornerRadius="10"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="0,-5,-5,0"
                Visibility="Collapsed">
            <TextBlock x:Name="NotificationCount"
                      Text="0"
                      Foreground="White"
                      FontSize="11"
                      FontWeight="Bold"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"/>
        </Border>
        
        <!-- Tooltip -->
        <Grid.ToolTip>
            <ToolTip>
                <StackPanel>
                    <TextBlock Text="Candy-Bot" FontWeight="Bold" FontSize="14"/>
                    <TextBlock Text="Your Sweet AI DJ Assistant" FontSize="11" Foreground="#888888"/>
                    <Separator Margin="0,4"/>
                    <TextBlock Text="Left-click: Chat" FontSize="10"/>
                    <TextBlock Text="Right-click: Settings" FontSize="10"/>
                </StackPanel>
            </ToolTip>
        </Grid.ToolTip>
    </Grid>
</UserControl>
