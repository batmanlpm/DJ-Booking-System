<UserControl x:Class="DJBookingSystem.Views.UsersView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:conv="clr-namespace:DJBookingSystem.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1160"
             Background="Black">
    <UserControl.Resources>
        <!-- Bool to Status Color Converter (Green=Online, Red=Offline) -->
        <conv:BoolToStatusColorConverter x:Key="BoolToStatusColorConverter"/>
    </UserControl.Resources>
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="220"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Left Sidebar Menu -->
        <Border Grid.Column="0" Grid.Row="0" Grid.RowSpan="3"
               Background="#0A0A0A" 
               BorderBrush="#00FF00" 
               BorderThickness="0,0,2,0">
            <StackPanel Margin="10">
                <!-- Title -->
                <TextBlock Text="USER MANAGEMENT" 
                          FontSize="14" 
                          FontWeight="Bold" 
                          Foreground="#00FF00" 
                          FontFamily="Consolas"
                          Margin="0,0,0,20"
                          TextAlignment="Center">
                    <TextBlock.Effect>
                        <DropShadowEffect Color="#00FF00" BlurRadius="10" ShadowDepth="0"/>
                    </TextBlock.Effect>
                </TextBlock>

                <!-- Filter Section -->
                <TextBlock Text="FILTERS" 
                          FontSize="11" 
                          FontWeight="Bold" 
                          Foreground="#FF1493" 
                          FontFamily="Consolas"
                          Margin="5,0,0,5"/>
                
                <Button x:Name="AllUsersButton"
                       Content="All Users" 
                       Click="FilterAllUsers_Click"
                       Style="{StaticResource SpaceButton}"
                       HorizontalAlignment="Stretch"
                       Margin="0,0,0,3"/>
                
                <Button x:Name="OnlineUsersButton"
                       Content="Online Users" 
                       Click="FilterOnlineUsers_Click"
                       Style="{StaticResource SpaceButton}"
                       HorizontalAlignment="Stretch"
                       Margin="0,0,0,3"/>
                
                <Button x:Name="OfflineUsersButton"
                       Content="Offline Users" 
                       Click="FilterOfflineUsers_Click"
                       Style="{StaticResource SpaceButton}"
                       HorizontalAlignment="Stretch"
                       Margin="0,0,0,15"/>

                <!-- Actions Section -->
                <TextBlock Text="ACTIONS" 
                          FontSize="11" 
                          FontWeight="Bold" 
                          Foreground="#FF1493" 
                          FontFamily="Consolas"
                          Margin="5,0,0,5"/>
                
                <!-- Pop Out Button -->
                <Button Content="Pop Out Window" 
                       Click="PopOut_Click"
                       Style="{StaticResource SpaceButton}"
                       HorizontalAlignment="Stretch"
                       Margin="0,0,0,10"
                       ToolTip="Open in maximizable window"/>
                
                <Button Content="Create User" 
                       Click="NewUser_Click"
                       Style="{StaticResource SpaceButton}"
                       HorizontalAlignment="Stretch"
                       Margin="0,0,0,3"/>
                
                <Button Content="Edit User" 
                       Click="EditUser_Click"
                       Style="{StaticResource SpaceButton}"
                       HorizontalAlignment="Stretch"
                       Margin="0,0,0,3"/>
                
                <Button Content="Delete User" 
                       Click="DeleteUser_Click"
                       Style="{StaticResource SpaceButton}"
                       HorizontalAlignment="Stretch"
                       Margin="0,0,0,3"/>
                
                <Button Content="Mute/Unmute" 
                       Click="MuteToggle_Click"
                       Style="{StaticResource SpaceButton}"
                       HorizontalAlignment="Stretch"
                       Margin="0,0,0,3"/>
                
                <Button Content="Ban/Unban" 
                       Click="BanToggle_Click"
                       Style="{StaticResource SpaceButton}"
                       HorizontalAlignment="Stretch"
                       Margin="0,0,0,3"/>
                
                <Button Content="Promote/Demote" 
                       Click="PromoteDemote_Click"
                       Style="{StaticResource SpaceButton}"
                       HorizontalAlignment="Stretch"
                       Margin="0,0,0,3"/>
                
                <Button Content="Manage Permissions" 
                       Click="ManagePermissions_Click"
                       Style="{StaticResource SpaceButton}"
                       HorizontalAlignment="Stretch"
                       Margin="0,0,0,3"/>
                
                <Button Content="Permission Groups" 
                       Click="PermissionGroups_Click"
                       Style="{StaticResource SpaceButton}"
                       HorizontalAlignment="Stretch"
                       Margin="0,0,0,15"/>

                <!-- Reports Section -->
                <TextBlock Text="REPORTS" 
                          FontSize="11" 
                          FontWeight="Bold" 
                          Foreground="#FF1493" 
                          FontFamily="Consolas"
                          Margin="5,0,0,5"/>
                
                <Button Content="Error Reports" 
                       Click="ErrorReports_Click"
                       Style="{StaticResource SpaceButton}"
                       HorizontalAlignment="Stretch"
                       Margin="0,0,0,3"/>
                
                <Button Content="Audit Log" 
                       Click="AuditLog_Click"
                       Style="{StaticResource SpaceButton}"
                       HorizontalAlignment="Stretch"
                       Margin="0,0,0,3"/>
                
                <!-- Auto-Refresh Section -->
                <Separator Margin="0,15,0,10" Background="#00FF00"/>
                
                <TextBlock Text="AUTO-REFRESH" 
                          FontSize="11" 
                          FontWeight="Bold" 
                          Foreground="#FF1493" 
                          FontFamily="Consolas"
                          Margin="5,0,0,5"/>
                
                <CheckBox x:Name="AutoRefreshCheckBox"
                         Content="Enable Auto-Refresh"
                         Foreground="#00FF00"
                         FontFamily="Consolas"
                         FontSize="10"
                         IsChecked="True"
                         Checked="AutoRefresh_CheckedChanged"
                         Unchecked="AutoRefresh_CheckedChanged"
                         Margin="0,0,0,5"/>
                
                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                    <TextBlock Text="Interval:"
                              Foreground="#888888"
                              FontFamily="Consolas"
                              FontSize="9"
                              VerticalAlignment="Center"
                              Margin="0,0,5,0"/>
                    <TextBlock x:Name="RefreshIntervalText"
                              Text="30s"
                              Foreground="#00FF00"
                              FontFamily="Consolas"
                              FontSize="9"
                              FontWeight="Bold"
                              VerticalAlignment="Center"/>
                </StackPanel>
                
                <TextBlock x:Name="LastRefreshText"
                          Text="Last: Never"
                          Foreground="#888888"
                          FontFamily="Consolas"
                          FontSize="8"
                          Margin="0,0,0,10"/>
                
                <Button x:Name="RefreshButton"
                       Content="?? Refresh Now" 
                       Click="Refresh_Click"
                       Style="{StaticResource SpaceButton}"
                       HorizontalAlignment="Stretch"
                       Margin="0,0,0,0"
                       ToolTip="Manually refresh user list"/>
            </StackPanel>
        </Border>

        <!-- Main Content Area -->
        <!-- Header -->
        <Border Grid.Column="1" Grid.Row="0" Background="#0A0A0A" BorderBrush="#00FF00" BorderThickness="0,0,0,2" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Title -->
                <TextBlock Grid.Column="0" 
                          Text="USER MANAGEMENT" 
                          FontSize="18" 
                          FontWeight="Bold" 
                          Foreground="#00FF00" 
                          FontFamily="Consolas" 
                          HorizontalAlignment="Left" 
                          VerticalAlignment="Center">
                    <TextBlock.Effect>
                        <DropShadowEffect Color="#00FF00" BlurRadius="10" ShadowDepth="0"/>
                    </TextBlock.Effect>
                </TextBlock>

                <!-- Quick Filter -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <TextBlock Text="Quick Filter:" 
                              Foreground="#00FF00" 
                              FontFamily="Consolas"
                              VerticalAlignment="Center" 
                              Margin="5,0"/>
                    <ComboBox x:Name="FilterComboBox"
                             Width="150" 
                             Margin="5,0"
                             SelectionChanged="FilterComboBox_SelectionChanged">
                        <ComboBoxItem Content="All Users" IsSelected="True"/>
                        <ComboBoxItem Content="Online Only"/>
                        <ComboBoxItem Content="Offline Only"/>
                        <ComboBoxItem Content="Active Only"/>
                        <ComboBoxItem Content="Banned Only"/>
                        <ComboBoxItem Content="Admins Only"/>
                        <ComboBoxItem Content="DJs Only"/>
                        <ComboBoxItem Content="Venue Owners Only"/>
                    </ComboBox>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Users DataGrid -->
        <Border Grid.Column="1" Grid.Row="1" 
               Background="Black" 
               BorderBrush="#00FF00" 
               BorderThickness="2" 
               Margin="10">
            <DataGrid x:Name="UsersDataGrid" 
                     Background="#0A0A0A" 
                     Foreground="#00FF00" 
                     BorderBrush="#00FF00"
                     AutoGenerateColumns="False"
                     CanUserAddRows="False"
                     CanUserDeleteRows="False"
                     GridLinesVisibility="All"
                     AlternatingRowBackground="#001100"
                     RowBackground="#000000"
                     FontFamily="Consolas"
                     CellEditEnding="UsersDataGrid_CellEditEnding" SelectionChanged="UsersDataGrid_SelectionChanged">
                
                <!-- Column Header Style -->
                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="#000000"/>
                        <Setter Property="Foreground" Value="#FF1493"/>
                        <Setter Property="FontFamily" Value="Consolas"/>
                        <Setter Property="FontWeight" Value="Bold"/>
                        <Setter Property="FontSize" Value="12"/>
                        <Setter Property="Padding" Value="10,8"/>
                        <Setter Property="BorderBrush" Value="#FF1493"/>
                        <Setter Property="BorderThickness" Value="0,0,1,2"/>
                        <Setter Property="HorizontalContentAlignment" Value="Left"/>
                    </Style>
                </DataGrid.ColumnHeaderStyle>
                
                <DataGrid.Columns>
                    <!-- Username Column -->
                    <DataGridTextColumn Header="Username" 
                                       Binding="{Binding Username}" 
                                       Width="150"
                                       IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#00FF00"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter Property="FontSize" Value="14"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <!-- Status Column (Colored Box: Green=Online, Red=Offline) -->
                    <DataGridTemplateColumn Header="Status" Width="80">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Width="60" 
                                        Height="30" 
                                        Background="{Binding IsOnline, Converter={StaticResource BoolToStatusColorConverter}}"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <!-- Role Column -->
                    <DataGridTextColumn Header="Role" 
                                       Binding="{Binding Role}" 
                                       Width="120"
                                       IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#00FF00"/>
                                <Setter Property="FontSize" Value="13"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <!-- IP Address Column -->
                    <DataGridTextColumn Header="IP Address" 
                                       Binding="{Binding CurrentIP}" 
                                       Width="150"
                                       IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#00FF00"/>
                                <Setter Property="FontSize" Value="12"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <!-- Active Checkbox -->
                    <DataGridCheckBoxColumn Header="Active" 
                                           Binding="{Binding IsActive}" 
                                           Width="80"
                                           IsReadOnly="True"/>
                    
                    <!-- Banned Checkbox -->
                    <DataGridCheckBoxColumn Header="Banned" 
                                           Binding="{Binding IsBanned}" 
                                           Width="80"
                                           IsReadOnly="True"/>
                    
                    <!-- DJ Checkbox -->
                    <DataGridCheckBoxColumn Header="DJ" 
                                           Binding="{Binding IsDJ, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                           Width="60"/>
                    
                    <!-- Venue Owner Checkbox -->
                    <DataGridCheckBoxColumn Header="Venue Owner" 
                                           Binding="{Binding IsVenueOwner, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                           Width="120"/>
                    
                    <!-- Tutorial Seen Checkbox -->
                    <DataGridCheckBoxColumn Header="Tutorial" 
                                           Binding="{Binding HasSeenTutorial, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                           Width="100"
                                           ToolTipService.ToolTip="Checked = User has seen tutorial&#x0a;Unchecked = User will see mandatory tutorial on next login"/>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Column="1" Grid.Row="2" 
               Background="#0A0A0A" 
               BorderBrush="#00FF00" 
               BorderThickness="0,2,0,0" 
               Padding="10,5">
            <TextBlock x:Name="StatusText" 
                      Text="Ready" 
                      Foreground="#00FF00" 
                      FontFamily="Consolas" 
                      FontSize="11"/>
        </Border>
    </Grid>
</UserControl>